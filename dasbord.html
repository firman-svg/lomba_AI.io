<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelas XI-7 VALLORIX - SMA Negeri 4 Bojonegoro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary-color: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary-color: #10b981;
            --secondary-light: #34d399;
            --secondary-dark: #059669;
            --accent-color: #f59e0b;
            --accent-light: #fbbf24;
            --accent-dark: #d97706;
            --danger-color: #ef4444;
            --danger-light: #f87171;
            --danger-dark: #dc2626;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --info-light: #60a5fa;
            --info-dark: #2563eb;
            --purple-color: #8b5cf6;
            --pink-color: #ec4899;
            --teal-color: #14b8a6;
            --cyan-color: #06b6d4;
            --indigo-color: #6366f1;
            --rose-color: #f43f5e;
            --amber-color: #f59e0b;
            --emerald-color: #10b981;
            --violet-color: #8b5cf6;
            --text-dark: #1f2937;
            --text-medium: #374151;
            --text-light: #6b7280;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --border-color: #e5e7eb;
            --border-light: #f3f4f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 6px 10px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --transition: all 0.3s ease;
            --transition-slow: all 0.5s ease;
        }

        body {
            background: linear-gradient(135deg, #f0f4ff, #e6f7ff);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--purple-color));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .loading-logo::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--primary-light), var(--pink-color), var(--accent-light));
            border-radius: 50%;
            z-index: -1;
            animation: rotate 10s linear infinite;
        }

        .loading-text {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .loading-bar {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            width: 0%;
            background: white;
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .class-website {
            min-height: 100vh;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .class-website.loaded {
            opacity: 1;
            transform: translateY(0);
        }

        /* Header Styles */
        .class-header {
            background: linear-gradient(135deg, var(--primary-color), var(--purple-color));
            color: white;
            padding: 30px 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .class-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="%23ffffff" opacity="0.05"><polygon points="0,0 1000,50 1000,100 0,100"/></svg>');
            background-size: cover;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .class-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .class-avatar {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        .class-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .class-avatar::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--primary-light), var(--pink-color), var(--accent-light));
            border-radius: 50%;
            z-index: -1;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .class-details h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(45deg, #ffffff, #e0f2fe);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .class-details p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .header-stats {
            display: flex;
            gap: 30px;
        }

        .stat {
            text-align: center;
            position: relative;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 3px;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Navigation */
        .class-nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
            padding: 0 10px;
        }

        .nav-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Edge */
        }

        .nav-item {
            padding: 20px 25px;
            text-decoration: none;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            cursor: pointer;
            position: relative;
        }

        .nav-item:hover {
            color: var(--primary-color);
            background: var(--bg-light);
        }

        .nav-item.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: rgba(79, 70, 229, 0.05);
        }

        .nav-item i {
            font-size: 1.1rem;
        }

        /* Main Content */
        .class-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard Styles */
        .welcome-banner {
            background: linear-gradient(135deg, var(--bg-white), #f0f9ff);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            align-items: start;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            border-radius: 0 0 0 100px;
            opacity: 0.05;
        }

        .welcome-text h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--text-dark);
            background: linear-gradient(45deg, var(--primary-color), var(--purple-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .welcome-text p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .class-announcement {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffeaa7;
            border-radius: var(--radius-md);
            padding: 20px;
            position: relative;
            box-shadow: var(--shadow);
        }

        .announcement-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .announcement-header i {
            color: var(--warning-color);
            font-size: 1.2rem;
        }

        .announcement-header h3 {
            color: var(--text-dark);
            font-size: 1.2rem;
        }

        .announcement-content p {
            color: var(--text-dark);
            line-height: 1.5;
        }

        .edit-announcement-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: var(--radius-sm);
        }

        .edit-announcement-btn:hover {
            color: var(--primary-color);
            background: rgba(79, 70, 229, 0.1);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .stats-section, .schedule-section, .assignments-section, .activity-section, .absence-alert-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border-light);
        }

        .stats-section:hover, .schedule-section:hover, .assignments-section:hover, .activity-section:hover, .absence-alert-section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-5px);
        }

        .stats-section {
            grid-column: 1 / -1;
        }

        .absence-alert-section {
            grid-column: 1 / -1;
        }

        .stats-section h3, .schedule-section h3, .assignments-section h3, .activity-section h3, .absence-alert-section h3 {
            margin-bottom: 20px;
            color: var(--text-dark);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: var(--radius-md);
            border-left: 4px solid var(--primary-color);
            background: var(--bg-light);
            transition: var(--transition);
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-card.present { border-left-color: var(--secondary-color); }
        .stat-card.sick { border-left-color: var(--warning-color); }
        .stat-card.permission { border-left-color: var(--info-color); }
        .stat-card.absent { border-left-color: var(--danger-color); }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
        }

        .stat-card.present .stat-icon { background: var(--secondary-color); }
        .stat-card.sick .stat-icon { background: var(--warning-color); }
        .stat-card.permission .stat-icon { background: var(--info-color); }
        .stat-card.absent .stat-icon { background: var(--danger-color); }

        .stat-info h4 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-info span {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Schedule Items */
        .today-schedule {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .schedule-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .schedule-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .schedule-item.current {
            border-color: var(--primary-color);
            background: rgba(79, 70, 229, 0.05);
        }

        .schedule-time {
            font-weight: 600;
            color: var(--text-dark);
            min-width: 100px;
        }

        .schedule-details {
            flex: 1;
        }

        .schedule-details h4 {
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .schedule-details p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .schedule-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: var(--bg-light);
            color: var(--text-light);
        }

        .schedule-item.current .schedule-status {
            background: var(--primary-color);
            color: white;
        }

        /* Teacher Status Badge */
        .teacher-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .teacher-present {
            background: var(--secondary-color);
            color: white;
        }

        .teacher-absent {
            background: var(--danger-color);
            color: white;
        }

        .edit-schedule-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }

        .edit-schedule-btn:hover {
            color: var(--primary-color);
            background: rgba(79, 70, 229, 0.1);
        }

        /* Assignments */
        .assignments-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .assignment-item {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--info-color);
            transition: var(--transition);
            cursor: pointer;
        }

        .assignment-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .assignment-item.urgent {
            border-left-color: var(--danger-color);
            background: rgba(239, 68, 68, 0.05);
        }

        .assignment-item.completed {
            border-left-color: var(--secondary-color);
            background: rgba(16, 185, 129, 0.05);
        }

        .assignment-subject {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .assignment-title {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .assignment-deadline {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .assignment-item.urgent .assignment-deadline {
            color: var(--danger-color);
        }

        /* Activity List */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            transition: var(--transition);
            cursor: pointer;
        }

        .activity-item:hover {
            transform: translateX(5px);
            background: white;
            box-shadow: var(--shadow);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .activity-content {
            flex: 1;
        }

        .activity-content p {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Tab Header */
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .tab-header h2 {
            color: var(--text-dark);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover, .btn-secondary.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .full-width {
            width: 100%;
        }

        /* Attendance Table */
        .attendance-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .date-selector label {
            font-weight: 500;
        }

        .date-selector input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .date-selector input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .view-options {
            display: flex;
            gap: 5px;
        }

        .attendance-table-container {
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .attendance-table th {
            background: var(--bg-light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-color);
        }

        .attendance-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .attendance-table tr:last-child td {
            border-bottom: none;
        }

        .attendance-table tr:hover {
            background: var(--bg-light);
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-present { background: #d1fae5; color: #065f46; }
        .status-sick { background: #fef3c7; color: #92400e; }
        .status-permission { background: #dbeafe; color: #1e40af; }
        .status-absent { background: #fee2e2; color: #991b1b; }
        .status-not-filled { background: #f3f4f6; color: #6b7280; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            color: var(--text-dark);
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: var(--bg-light);
            color: var(--danger-color);
        }

        .modal-body {
            padding: 25px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Students Attendance List */
        .students-attendance-list h4 {
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .attendance-student-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .attendance-student-item:hover {
            background: var(--bg-light);
        }

        .student-attendance-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .student-avatar-small {
            width: 35px;
            height: 35px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .attendance-options-small {
            display: flex;
            gap: 8px;
        }

        .attendance-btn-small {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .attendance-btn-small.active {
            color: white;
        }

        .attendance-btn-small.present.active { background: var(--secondary-color); border-color: var(--secondary-color); }
        .attendance-btn-small.sick.active { background: var(--warning-color); border-color: var(--warning-color); }
        .attendance-btn-small.permission.active { background: var(--info-color); border-color: var(--info-color); }
        .attendance-btn-small.absent.active { background: var(--danger-color); border-color: var(--danger-color); }

        /* Students Grid */
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .student-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .student-avatar-large {
            width: 80px;
            height: 80px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 auto 15px;
        }

        .student-card h4 {
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .student-nis {
            color: var(--text-light);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .student-contact {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Teachers Grid */
        .teachers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .teacher-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
            cursor: pointer;
        }

        .teacher-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .teacher-avatar {
            width: 70px;
            height: 70px;
            background: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .teacher-info h4 {
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .teacher-subject {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .teacher-qualification {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Weekly Schedule */
        .weekly-schedule {
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .schedule-days {
            display: grid;
            grid-template-columns: 120px repeat(6, 1fr);
            background: var(--primary-color);
            color: white;
            min-width: 800px;
        }

        .day-header {
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .day-header:first-child {
            background: var(--primary-dark);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 120px repeat(6, 1fr);
            min-width: 800px;
        }

        .schedule-cell {
            padding: 15px;
            border: 1px solid var(--border-color);
            min-height: 80px;
        }

        .schedule-cell.time {
            background: var(--bg-light);
            font-weight: 600;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .schedule-lesson {
            background: rgba(79, 70, 229, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: var(--radius-sm);
            padding: 10px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .schedule-lesson:hover {
            transform: scale(1.02);
            background: rgba(79, 70, 229, 0.15);
        }

        .schedule-lesson h5 {
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .schedule-lesson p {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .schedule-lesson-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .schedule-edit-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .schedule-edit-btn:hover {
            color: var(--primary-color);
            background: rgba(79, 70, 229, 0.1);
        }

        /* Search Box */
        .search-box {
            position: relative;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 300px;
            transition: var(--transition);
        }

        .search-box:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .search-box i {
            color: var(--text-light);
        }

        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 1rem;
        }

        /* Assignment Detailed */
        .assignment-item-detailed {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--info-color);
            transition: var(--transition);
            position: relative;
        }

        .assignment-item-detailed:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .assignment-item-detailed.urgent {
            border-left-color: var(--danger-color);
        }

        .assignment-item-detailed.completed {
            border-left-color: var(--secondary-color);
        }

        .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .assignment-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .assignment-status.urgent {
            background: #fee2e2;
            color: #991b1b;
        }

        .assignment-status.active {
            background: #dbeafe;
            color: #1e40af;
        }

        .assignment-status.completed {
            background: #d1fae5;
            color: #065f46;
        }

        .assignment-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .assignment-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-small:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        /* Assignment Filters */
        .assignment-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .filter-btn.active, .filter-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        /* Export Button */
        .export-btn {
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .export-btn:hover {
            background: linear-gradient(135deg, var(--secondary-dark), var(--secondary-color));
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            opacity: 0;
            transform: translateX(100px);
            transition: var(--transition-slow);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger-color);
        }

        /* Empty State */
        .empty-placeholder {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
            border: 1px dashed var(--border-color);
            border-radius: var(--radius-md);
            margin: 20px 0;
        }

        .empty-placeholder i {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* Attendance Summary */
        .attendance-summary {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .summary-card h4 {
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item .label {
            color: var(--text-light);
        }

        .summary-item .value {
            font-weight: 600;
        }

        .summary-item .value.present {
            color: var(--secondary-color);
        }

        .summary-item .value.absent {
            color: var(--danger-color);
        }

        /* NEW: Absence Alert Styles */
        .absence-alert-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .absence-alert-item {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--danger-color);
            transition: var(--transition);
        }

        .absence-alert-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .absence-alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .absence-alert-student {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1.1rem;
        }

        .absence-alert-count {
            background: var(--danger-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .absence-alert-subjects {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .absence-alert-subject {
            background: var(--bg-light);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .absence-alert-subject.absent {
            background: #fee2e2;
            color: #991b1b;
        }

        .absence-alert-subject.sick {
            background: #fef3c7;
            color: #92400e;
        }

        .absence-alert-subject.permission {
            background: #dbeafe;
            color: #1e40af;
        }

        /* NEW: Student Absence Report */
        .student-absence-report {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .student-absence-report h3 {
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .absence-report-table {
            width: 100%;
            border-collapse: collapse;
        }

        .absence-report-table th {
            background: var(--bg-light);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-color);
        }

        .absence-report-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .absence-report-table tr:last-child td {
            border-bottom: none;
        }

        .absence-report-table tr:hover {
            background: var(--bg-light);
        }

        .absence-report-actions {
            display: flex;
            gap: 8px;
        }

        /* NEW: Absence Pattern Styles */
        .absence-pattern-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .pattern-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: end;
        }

        .pattern-filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .pattern-filter-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-light);
        }

        .pattern-filter-group input, .pattern-filter-group select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .pattern-filter-group input:focus, .pattern-filter-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* NEW: Group Spinner Styles */
        .group-spinner-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .group-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: end;
        }

        .group-control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .group-control-item label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-light);
        }

        .group-control-item input, .group-control-item select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .group-control-item input:focus, .group-control-item select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .group-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .group-name {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .group-member-count {
            background: var(--primary-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .group-members {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .group-member {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: var(--radius-sm);
            background: var(--bg-light);
            transition: var(--transition);
        }

        .group-member:hover {
            background: var(--border-light);
        }

        .group-member-avatar {
            width: 30px;
            height: 30px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .group-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* NEW: Spinner Animation */
        .spinner-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            margin: 20px 0;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--bg-light);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner-text {
            color: var(--text-light);
            font-weight: 500;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--purple-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 99;
            transition: var(--transition);
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        /* Quick Actions Menu */
        .quick-action-item {
            position: fixed;
            background: white;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            z-index: 98;
            animation: slideInRight 0.3s ease-out both;
            transition: var(--transition);
        }

        .quick-action-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(-5px);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* NEW: Color Variants for Enhanced Aesthetics */
        .color-variant-1 { background: linear-gradient(135deg, var(--primary-color), var(--purple-color)); }
        .color-variant-2 { background: linear-gradient(135deg, var(--secondary-color), var(--teal-color)); }
        .color-variant-3 { background: linear-gradient(135deg, var(--warning-color), var(--amber-color)); }
        .color-variant-4 { background: linear-gradient(135deg, var(--info-color), var(--cyan-color)); }
        .color-variant-5 { background: linear-gradient(135deg, var(--danger-color), var(--rose-color)); }
        .color-variant-6 { background: linear-gradient(135deg, var(--purple-color), var(--violet-color)); }
        .color-variant-7 { background: linear-gradient(135deg, var(--teal-color), var(--emerald-color)); }
        .color-variant-8 { background: linear-gradient(135deg, var(--amber-color), var(--warning-color)); }

        /* NEW: Enhanced Card Styles */
        .enhanced-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .enhanced-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(135deg, var(--primary-color), var(--purple-color));
        }

        .enhanced-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        /* NEW: Animated Background Elements */
        .animated-bg-element {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s infinite ease-in-out;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* NEW: Enhanced Schedule Item */
        .enhanced-schedule-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .enhanced-schedule-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-color);
            transition: var(--transition);
        }

        .enhanced-schedule-item:hover::before {
            width: 8px;
            background: var(--secondary-color);
        }

        .enhanced-schedule-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .enhanced-schedule-item.current {
            border-color: var(--primary-color);
            background: rgba(79, 70, 229, 0.05);
        }

        .enhanced-schedule-item.current::before {
            background: var(--secondary-color);
            width: 8px;
        }

        /* NEW: Enhanced Assignment Item */
        .enhanced-assignment-item {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--info-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .enhanced-assignment-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 30px 30px 0;
            border-color: transparent rgba(79, 70, 229, 0.1) transparent transparent;
            transition: var(--transition);
        }

        .enhanced-assignment-item:hover::before {
            border-width: 0 40px 40px 0;
        }

        .enhanced-assignment-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .enhanced-assignment-item.urgent {
            border-left-color: var(--danger-color);
        }

        .enhanced-assignment-item.completed {
            border-left-color: var(--secondary-color);
        }

        /* NEW: Enhanced Stats Cards */
        .enhanced-stat-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: var(--radius-md);
            background: var(--bg-light);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .enhanced-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
            opacity: 0;
            transition: var(--transition);
        }

        .enhanced-stat-card:hover::before {
            opacity: 1;
        }

        .enhanced-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .enhanced-stat-card.present { border-left: 4px solid var(--secondary-color); }
        .enhanced-stat-card.sick { border-left: 4px solid var(--warning-color); }
        .enhanced-stat-card.permission { border-left: 4px solid var(--info-color); }
        .enhanced-stat-card.absent { border-left: 4px solid var(--danger-color); }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .welcome-banner {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .class-info {
                flex-direction: column;
                text-align: center;
            }
            
            .header-stats {
                justify-content: center;
                width: 100%;
            }
            
            .stat {
                flex: 1;
                min-width: 120px;
            }
            
            .nav-container {
                justify-content: flex-start;
            }
            
            .tab-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .attendance-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .students-grid {
                grid-template-columns: 1fr;
            }
            
            .teachers-grid {
                grid-template-columns: 1fr;
            }
            
            .schedule-days, .schedule-grid {
                grid-template-columns: 80px repeat(6, 1fr);
                font-size: 0.8rem;
            }
            
            .pattern-filters, .group-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .pattern-filter-group, .group-control-item {
                width: 100%;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .class-details h1 {
                font-size: 2rem;
            }
            
            .class-avatar {
                width: 80px;
                height: 80px;
            }
        }

        @media (max-width: 480px) {
            .class-details h1 {
                font-size: 1.8rem;
            }
            
            .schedule-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .schedule-time {
                min-width: auto;
            }
            
            .attendance-table {
                font-size: 0.8rem;
            }
            
            .attendance-table th,
            .attendance-table td {
                padding: 10px 8px;
            }
            
            .absence-alert-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .group-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .group-actions {
                flex-direction: column;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
            
            .stat {
                padding: 8px 10px;
            }
            
            .nav-item {
                padding: 15px 20px;
            }
            
            .class-main {
                padding: 20px 15px;
            }
            
            .welcome-banner, .stats-section, .schedule-section, .assignments-section, .activity-section, .absence-alert-section {
                padding: 20px;
            }
            
            .tab-header h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-graduation-cap"></i>
        </div>
        <div class="loading-text">Kelas XI-7 VALLORIX</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>

    <div class="class-website" id="classWebsite">
        <!-- Header -->
        <header class="class-header">
            <div class="header-content">
                <div class="class-info">
                    <div class="class-avatar">
                        <!-- Logo kelas akan dimuat di sini -->
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="class-details">
                        <h1>Kelas XI-7 VALLORIX</h1>
                        <p>SMA Negeri 4 Bojonegoro  Tahun Ajaran 2024/2025</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat">
                        <span class="stat-number">36</span>
                        <span class="stat-label">Siswa</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">12</span>
                        <span class="stat-label">Mapel</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">5</span>
                        <span class="stat-label">Guru</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="class-nav">
            <div class="nav-container">
                <a href="#dashboard" class="nav-item active" data-tab="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#attendance" class="nav-item" data-tab="attendance">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Absensi</span>
                </a>
                <a href="#absence-tracking" class="nav-item" data-tab="absence-tracking">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Pelacakan Bolos</span>
                </a>
                <a href="#group-spinner" class="nav-item" data-tab="group-spinner">
                    <i class="fas fa-random"></i>
                    <span>Pembagian Kelompok</span>
                </a>
                <a href="#schedule" class="nav-item" data-tab="schedule">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Jadwal</span>
                </a>
                <a href="#students" class="nav-item" data-tab="students">
                    <i class="fas fa-user-graduate"></i>
                    <span>Siswa</span>
                </a>
                <a href="#teachers" class="nav-item" data-tab="teachers">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Guru</span>
                </a>
                <a href="#assignments" class="nav-item" data-tab="assignments">
                    <i class="fas fa-tasks"></i>
                    <span>Tugas</span>
                </a>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="class-main">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="welcome-banner">
                    <div class="welcome-text">
                        <h2>Selamat Datang di Kelas XI-7 VALLORIX! </h2>
                        <p>Platform digital untuk pembelajaran dan manajemen kelas</p>
                    </div>
                    <div class="class-announcement">
                        <div class="announcement-header">
                            <i class="fas fa-bullhorn"></i>
                            <h3>Pengumuman</h3>
                            <button class="edit-announcement-btn" onclick="app.editAnnouncement()">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                        <div class="announcement-content">
                            <p id="announcementText">Persiapan Ujian Tengah Semester akan dimulai minggu depan. Mari persiapkan dengan baik!</p>
                        </div>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <!-- Quick Stats -->
                    <div class="stats-section">
                        <h3>Statistik Hari Ini</h3>
                        <div class="stats-grid">
                            <div class="enhanced-stat-card present" onclick="app.showAttendanceDetails('present')">
                                <div class="stat-icon">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="stat-info">
                                    <h4 id="presentCount">0</h4>
                                    <span>Hadir</span>
                                </div>
                            </div>
                            <div class="enhanced-stat-card sick" onclick="app.showAttendanceDetails('sick')">
                                <div class="stat-icon">
                                    <i class="fas fa-procedures"></i>
                                </div>
                                <div class="stat-info">
                                    <h4 id="sickCount">0</h4>
                                    <span>Sakit</span>
                                </div>
                            </div>
                            <div class="enhanced-stat-card permission" onclick="app.showAttendanceDetails('permission')">
                                <div class="stat-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="stat-info">
                                    <h4 id="permissionCount">0</h4>
                                    <span>Izin</span>
                                </div>
                            </div>
                            <div class="enhanced-stat-card absent" onclick="app.showAttendanceDetails('absent')">
                                <div class="stat-icon">
                                    <i class="fas fa-user-times"></i>
                                </div>
                                <div class="stat-info">
                                    <h4 id="absentCount">36</h4>
                                    <span>Alpha</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NEW: Absence Alert Section -->
                    <div class="absence-alert-section">
                        <h3><i class="fas fa-exclamation-triangle"></i> Peringatan Ketidakhadiran</h3>
                        <div class="absence-alert-list" id="absenceAlertList">
                            <!-- Alert items will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Today's Schedule -->
                    <div class="schedule-section">
                        <h3>Jadwal Hari Ini</h3>
                        <div class="today-schedule" id="todaySchedule">
                            <!-- Today's schedule will be loaded here -->
                        </div>
                    </div>
                    <!-- Upcoming Assignments -->
                    <div class="assignments-section">
                        <h3>Tugas Mendatang</h3>
                        <div class="assignments-list" id="dashboardAssignmentsList">
                            <!-- Tugas akan dimuat secara dinamis -->
                        </div>
                    </div>
                    <!-- Recent Activity -->
                    <div class="activity-section">
                        <h3>Aktivitas Terbaru</h3>
                        <div class="activity-list" id="recentActivityList">
                            <!-- Recent activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Attendance Tab -->
            <div id="attendance" class="tab-content">
                <div class="tab-header">
                    <h2>Absensi Kelas XI-7 VALLORIX</h2>
                    <div>
                        <button class="export-btn" onclick="app.exportAttendance()">
                            <i class="fas fa-file-export"></i>
                            Ekspor Data
                        </button>
                        <button class="btn-primary" onclick="app.showAttendanceModal()">
                            <i class="fas fa-plus"></i>
                            Input Absensi
                        </button>
                    </div>
                </div>
                <div class="attendance-controls">
                    <div class="date-selector">
                        <label for="attendanceDate">Pilih Tanggal:</label>
                        <input type="date" id="attendanceDate">
                    </div>
                    <div class="view-options">
                        <button class="btn-secondary active">Harian</button>
                        <button class="btn-secondary">Mingguan</button>
                        <button class="btn-secondary">Bulanan</button>
                    </div>
                </div>
                <div class="attendance-table-container">
                    <table class="attendance-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Siswa</th>
                                <th>NIS</th>
                                <th>Status</th>
                                <th>Waktu</th>
                                <th>Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- Attendance data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="attendance-summary">
                    <div class="summary-card">
                        <h4>Ringkasan Kehadiran</h4>
                        <div class="summary-stats">
                            <div class="summary-item">
                                <span class="label">Total Siswa:</span>
                                <span class="value" id="totalStudentsSummary">36</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Hadir:</span>
                                <span class="value present" id="presentCountSummary">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Tidak Hadir:</span>
                                <span class="value absent" id="absentCountSummary">36</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- NEW: Absence Tracking Tab -->
            <div id="absence-tracking" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Pelacakan Ketidakhadiran Siswa</h2>
                    <div>
                        <button class="export-btn" onclick="app.exportAbsenceReport()">
                            <i class="fas fa-file-export"></i>
                            Ekspor Laporan
                        </button>
                    </div>
                </div>
                
                <div class="absence-pattern-section">
                    <h3>Pola Ketidakhadiran</h3>
                    <div class="pattern-filters">
                        <div class="pattern-filter-group">
                            <label for="absenceDateRange">Rentang Tanggal:</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="date" id="absenceStartDate">
                                <span>s/d</span>
                                <input type="date" id="absenceEndDate">
                            </div>
                        </div>
                        <div class="pattern-filter-group">
                            <label for="absenceTypeFilter">Jenis Ketidakhadiran:</label>
                            <select id="absenceTypeFilter">
                                <option value="all">Semua</option>
                                <option value="absent">Alpha</option>
                                <option value="sick">Sakit</option>
                                <option value="permission">Izin</option>
                            </select>
                        </div>
                        <div class="pattern-filter-group">
                            <label for="absenceThreshold">Ambang Batas:</label>
                            <select id="absenceThreshold">
                                <option value="1">1+ ketidakhadiran</option>
                                <option value="2">2+ ketidakhadiran</option>
                                <option value="3" selected>3+ ketidakhadiran</option>
                                <option value="5">5+ ketidakhadiran</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="app.loadAbsencePatterns()">
                            <i class="fas fa-filter"></i> Terapkan Filter
                        </button>
                    </div>
                    
                    <div class="student-absence-report">
                        <h3>Laporan Ketidakhadiran per Siswa</h3>
                        <div class="attendance-table-container">
                            <table class="absence-report-table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Siswa</th>
                                        <th>NIS</th>
                                        <th>Total Ketidakhadiran</th>
                                        <th>Mata Pelajaran yang Ditinggalkan</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="absenceReportTableBody">
                                    <!-- Absence report data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="absence-alert-section">
                    <h3><i class="fas fa-bell"></i> Siswa dengan Ketidakhadiran Tinggi</h3>
                    <div class="absence-alert-list" id="detailedAbsenceAlertList">
                        <!-- Detailed alert items will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- NEW: Group Spinner Tab -->
            <div id="group-spinner" class="tab-content">
                <div class="tab-header">
                    <h2><i class="fas fa-random"></i> Pembagian Kelompok Acak</h2>
                </div>
                
                <div class="group-spinner-section">
                    <h3>Pengaturan Pembagian Kelompok</h3>
                    <div class="group-controls">
                        <div class="group-control-item">
                            <label for="groupCount">Jumlah Kelompok:</label>
                            <input type="number" id="groupCount" min="2" max="10" value="4">
                        </div>
                        <div class="group-control-item">
                            <label for="groupMethod">Metode Pembagian:</label>
                            <select id="groupMethod">
                                <option value="random">Acak Penuh</option>
                                <option value="balanced">Seimbang (Gender/Nilai)</option>
                                <option value="leader">Dengan Pemimpin Kelompok</option>
                            </select>
                        </div>
                        <div class="group-control-item">
                            <label for="includeAbsent">Siswa Tidak Hadir:</label>
                            <select id="includeAbsent">
                                <option value="include">Termasuk</option>
                                <option value="exclude" selected>Kecualikan</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="app.generateGroups()">
                            <i class="fas fa-random"></i> Buat Kelompok
                        </button>
                        <button class="btn-secondary" onclick="app.regenerateGroups()">
                            <i class="fas fa-redo"></i> Acak Ulang
                        </button>
                    </div>
                    
                    <div class="spinner-container" id="groupSpinner">
                        <div class="spinner"></div>
                        <div class="spinner-text">Membuat kelompok acak...</div>
                    </div>
                    
                    <div class="groups-container" id="groupsContainer">
                        <!-- Groups will be loaded here -->
                    </div>
                    
                    <div class="group-actions">
                        <button class="export-btn" onclick="app.exportGroups()">
                            <i class="fas fa-print"></i> Cetak Kelompok
                        </button>
                        <button class="btn-secondary" onclick="app.saveGroups()">
                            <i class="fas fa-save"></i> Simpan Kelompok
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Schedule Tab -->
            <div id="schedule" class="tab-content">
                <div class="tab-header">
                    <h2>Jadwal Pelajaran XI-7 VALLORIX</h2>
                    <div class="schedule-actions">
                        <button class="btn-primary" onclick="app.showScheduleModal()">
                            <i class="fas fa-edit"></i>
                            Edit Jadwal
                        </button>
                        <button class="btn-secondary">
                            <i class="fas fa-print"></i>
                            Cetak Jadwal
                        </button>
                    </div>
                </div>
                <div class="weekly-schedule">
                    <div class="schedule-days">
                        <div class="day-header">Waktu</div>
                        <div class="day-header active">Senin</div>
                        <div class="day-header">Selasa</div>
                        <div class="day-header">Rabu</div>
                        <div class="day-header">Kamis</div>
                        <div class="day-header">Jumat</div>
                        <div class="day-header">Sabtu</div>
                    </div>
                    <div class="schedule-grid" id="scheduleGrid">
                        <!-- Schedule will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Students Tab -->
            <div id="students" class="tab-content">
                <div class="tab-header">
                    <h2>Data Siswa XI-7 VALLORIX</h2>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Cari siswa..." id="studentSearch">
                    </div>
                </div>
                <div class="students-grid" id="studentsGrid">
                    <!-- Students will be loaded here -->
                </div>
            </div>
            
            <!-- Teachers Tab -->
            <div id="teachers" class="tab-content">
                <div class="tab-header">
                    <h2>Guru Pengajar XI-7 VALLORIX</h2>
                </div>
                <div class="teachers-grid" id="teachersGrid">
                    <!-- Teachers will be loaded here -->
                </div>
            </div>
            
            <!-- Assignments Tab -->
            <div id="assignments" class="tab-content">
                <div class="tab-header">
                    <h2>Tugas & Pekerjaan Rumah</h2>
                    <button class="btn-primary" onclick="app.showAssignmentModal()">
                        <i class="fas fa-plus"></i>
                        Tambah Tugas
                    </button>
                </div>
                <div class="assignments-container">
                    <div class="assignment-filters">
                        <button class="filter-btn active" data-filter="all">Semua</button>
                        <button class="filter-btn" data-filter="active">Aktif</button>
                        <button class="filter-btn" data-filter="urgent">Mendesak</button>
                        <button class="filter-btn" data-filter="completed">Selesai</button>
                    </div>
                    <div class="assignments-list-detailed" id="assignmentsList">
                        <!-- Assignments will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Attendance Modal -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Input Absensi Harian</h3>
                <button class="close-btn" onclick="app.closeModal('attendanceModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="attendanceForm">
                    <div class="form-group">
                        <label for="modalDate">Tanggal</label>
                        <input type="date" id="modalDate" required>
                    </div>
                    <div class="form-group">
                        <label for="modalSubject">Mata Pelajaran</label>
                        <select id="modalSubject" required>
                            <option value="">Pilih Mapel</option>
                            <option value="matematika">Matematika</option>
                            <option value="fisika">Fisika</option>
                            <option value="kimia">Kimia</option>
                            <option value="biologi">Biologi</option>
                            <option value="bindo">Bahasa Indonesia</option>
                            <option value="bing">Bahasa Inggris</option>
                            <option value="tik">TIK Lanjut</option>
                            <option value="sosiologi">Sosiologi Lanjut</option>
                            <option value="ekonomi">Ekonomi Lanjut</option>
                            <option value="bahasa_jepang">Bahasa Jepang Lanjut</option>
                        </select>
                    </div>
                    <div class="students-attendance-list">
                        <h4>Daftar Siswa</h4>
                        <div id="attendanceStudentsList">
                            <!-- Students list for attendance -->
                        </div>
                    </div>
                    <button type="submit" class="btn-primary full-width">
                        <i class="fas fa-save"></i>
                        Simpan Absensi
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Assignment Modal -->
    <div id="assignmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="assignmentModalTitle">Tambah Tugas Baru</h3>
                <button class="close-btn" onclick="app.closeModal('assignmentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="assignmentForm">
                    <input type="hidden" id="assignmentId">
                    <div class="form-group">
                        <label for="assignmentSubject">Mata Pelajaran</label>
                        <select id="assignmentSubject" required>
                            <option value="">Pilih Mapel</option>
                            <option value="matematika">Matematika</option>
                            <option value="fisika">Fisika</option>
                            <option value="kimia">Kimia</option>
                            <option value="biologi">Biologi</option>
                            <option value="bindo">Bahasa Indonesia</option>
                            <option value="bing">Bahasa Inggris</option>
                            <option value="tik">TIK Lanjut</option>
                            <option value="sosiologi">Sosiologi Lanjut</option>
                            <option value="ekonomi">Ekonomi Lanjut</option>
                            <option value="bahasa_jepang">Bahasa Jepang Lanjut</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignmentTitle">Judul Tugas</label>
                        <input type="text" id="assignmentTitle" placeholder="Masukkan judul tugas" required>
                    </div>
                    <div class="form-group">
                        <label for="assignmentDescription">Deskripsi</label>
                        <textarea id="assignmentDescription" rows="3" placeholder="Masukkan deskripsi tugas"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="assignmentDeadline">Deadline</label>
                        <input type="date" id="assignmentDeadline" required>
                    </div>
                    <div class="form-group">
                        <label for="assignmentType">Jenis Tugas</label>
                        <select id="assignmentType" required>
                            <option value="pr">Pekerjaan Rumah</option>
                            <option value="ulangan">Ulangan</option>
                            <option value="proyek">Proyek</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignmentStatus">Status</label>
                        <select id="assignmentStatus" required>
                            <option value="active">Aktif</option>
                            <option value="urgent">Mendesak</option>
                            <option value="completed">Selesai</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary full-width">
                        <i class="fas fa-save"></i>
                        Simpan Tugas
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Pengumuman</h3>
                <button class="close-btn" onclick="app.closeModal('announcementModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="announcementForm">
                    <div class="form-group">
                        <label for="announcementTextInput">Isi Pengumuman</label>
                        <textarea id="announcementTextInput" rows="4" placeholder="Masukkan pengumuman baru"></textarea>
                    </div>
                    <button type="submit" class="btn-primary full-width">
                        <i class="fas fa-save"></i>
                        Simpan Pengumuman
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- NEW: Student Absence Detail Modal -->
    <div id="studentAbsenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="studentAbsenceModalTitle">Detail Ketidakhadiran Siswa</h3>
                <button class="close-btn" onclick="app.closeModal('studentAbsenceModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="studentAbsenceDetails">
                    <!-- Student absence details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Schedule Edit Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="scheduleModalTitle">Edit Jadwal Pelajaran</h3>
                <button class="close-btn" onclick="app.closeModal('scheduleModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <input type="hidden" id="scheduleId">
                    <div class="form-group">
                        <label for="scheduleDay">Hari</label>
                        <select id="scheduleDay" required>
                            <option value="">Pilih Hari</option>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                            <option value="Sabtu">Sabtu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="scheduleTime">Waktu</label>
                        <select id="scheduleTime" required>
                            <option value="">Pilih Waktu</option>
                            <option value="07:00-08:30">07:00-08:30</option>
                            <option value="08:30-10:00">08:30-10:00</option>
                            <option value="10:00-11:30">10:00-11:30</option>
                            <option value="11:30-13:00">11:30-13:00</option>
                            <option value="13:00-14:30">13:00-14:30</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="scheduleSubject">Mata Pelajaran</label>
                        <select id="scheduleSubject" required>
                            <option value="">Pilih Mapel</option>
                            <option value="Matematika">Matematika</option>
                            <option value="Fisika">Fisika</option>
                            <option value="Kimia">Kimia</option>
                            <option value="Biologi">Biologi</option>
                            <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                            <option value="Bahasa Inggris">Bahasa Inggris</option>
                            <option value="TIK Lanjut">TIK Lanjut</option>
                            <option value="Sosiologi Lanjut">Sosiologi Lanjut</option>
                            <option value="Ekonomi Lanjut">Ekonomi Lanjut</option>
                            <option value="Bahasa Jepang Lanjut">Bahasa Jepang Lanjut</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="scheduleTeacher">Guru</label>
                        <select id="scheduleTeacher" required>
                            <option value="">Pilih Guru</option>
                            <option value="Bu Sari, S.Pd">Bu Sari, S.Pd</option>
                            <option value="Pak Budi, M.Pd">Pak Budi, M.Pd</option>
                            <option value="Bu Dewi, S.Pd">Bu Dewi, S.Pd</option>
                            <option value="Pak Andi, S.Pd">Pak Andi, S.Pd</option>
                            <option value="Bu Rini, M.Pd">Bu Rini, M.Pd</option>
                            <option value="Bu Maya, S.Pd">Bu Maya, S.Pd</option>
                            <option value="Pak Joko, S.Kom">Pak Joko, S.Kom</option>
                            <option value="Bu Sinta, S.Sos">Bu Sinta, S.Sos</option>
                            <option value="Pak Rudi, S.E">Pak Rudi, S.E</option>
                            <option value="Bu Yuki, S.Pd">Bu Yuki, S.Pd</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="scheduleRoom">Ruangan</label>
                        <input type="text" id="scheduleRoom" placeholder="Masukkan ruangan" required>
                    </div>
                    <div class="form-group">
                        <label for="teacherStatus">Status Guru</label>
                        <select id="teacherStatus">
                            <option value="present">Hadir</option>
                            <option value="absent">Tidak Hadir</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary full-width">
                        <i class="fas fa-save"></i>
                        Simpan Jadwal
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        class ClassWebsite {
            constructor() {
                this.currentClass = 'XI-7 VALLORIX';
                this.students = this.loadStudents();
                this.teachers = this.loadTeachers();
                this.schedule = this.loadSchedule();
                this.attendance = this.loadAttendance();
                this.assignments = this.loadAssignments();
                this.announcement = this.loadAnnouncement();
                this.groups = this.loadGroups();
                this.activities = this.loadActivities();
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadDashboard();
                this.loadAttendanceTab();
                this.loadAbsenceTrackingTab();
                this.loadGroupSpinnerTab();
                this.loadScheduleTab();
                this.loadStudentsTab();
                this.loadTeachersTab();
                this.loadAssignmentsTab();
                this.updateAnnouncement();
            }

            bindEvents() {
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.switchTab(item.dataset.tab);
                    });
                });

                // Attendance form
                document.getElementById('attendanceForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitAttendance();
                });

                // Assignment form
                document.getElementById('assignmentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitAssignment();
                });

                // Announcement form
                document.getElementById('announcementForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveAnnouncement();
                });

                // Schedule form
                document.getElementById('scheduleForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitSchedule();
                });

                // Date change for attendance
                document.getElementById('attendanceDate').addEventListener('change', (e) => {
                    this.loadAttendanceData(e.target.value);
                });

                // Student search
                document.getElementById('studentSearch').addEventListener('input', (e) => {
                    this.filterStudents(e.target.value);
                });

                // Assignment filters
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filterAssignments(e.target.dataset.filter);
                    });
                });

                // Update attendance students when date or subject changes
                document.getElementById('modalDate').addEventListener('change', () => {
                    this.loadAttendanceStudents();
                });
                document.getElementById('modalSubject').addEventListener('change', () => {
                    this.loadAttendanceStudents();
                });

                // Set default dates for absence tracking
                const today = new Date();
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(today.getDate() - 7);
                
                document.getElementById('absenceStartDate').value = oneWeekAgo.toISOString().split('T')[0];
                document.getElementById('absenceEndDate').value = today.toISOString().split('T')[0];
            }

            loadStudents() {
                return [
                    { id: 1, name: 'Ahmad Rizki', nis: '2024001', email: 'ahmad1@email.com', phone: '081234567890', gender: 'L' },
                    { id: 2, name: 'Sari Dewi', nis: '2024002', email: 'sari2@email.com', phone: '081234567891', gender: 'P' },
                    { id: 3, name: 'Budi Santoso', nis: '2024003', email: 'budi3@email.com', phone: '081234567892', gender: 'L' },
                    { id: 4, name: 'Maya Sari', nis: '2024004', email: 'maya4@email.com', phone: '081234567893', gender: 'P' },
                    { id: 5, name: 'Rizki Pratama', nis: '2024005', email: 'rizki5@email.com', phone: '081234567894', gender: 'L' },
                    { id: 6, name: 'Dewi Lestari', nis: '2024006', email: 'dewi6@email.com', phone: '081234567895', gender: 'P' },
                    { id: 7, name: 'Andi Wijaya', nis: '2024007', email: 'andi7@email.com', phone: '081234567896', gender: 'L' },
                    { id: 8, name: 'Siti Nurhaliza', nis: '2024008', email: 'siti8@email.com', phone: '081234567897', gender: 'P' },
                    { id: 9, name: 'Eko Prasetya', nis: '2024009', email: 'eko9@email.com', phone: '081234567898', gender: 'L' },
                    { id: 10, name: 'Lina Kusuma', nis: '2024010', email: 'lina10@email.com', phone: '081234567899', gender: 'P' },
                    { id: 11, name: 'Fajar Nugroho', nis: '2024011', email: 'fajar11@email.com', phone: '081234567800', gender: 'L' },
                    { id: 12, name: 'Intan Permata', nis: '2024012', email: 'intan12@email.com', phone: '081234567801', gender: 'P' },
                    { id: 13, name: 'Guntur Prakasa', nis: '2024013', email: 'guntur13@email.com', phone: '081234567802', gender: 'L' },
                    { id: 14, name: 'Heni Susanti', nis: '2024014', email: 'heni14@email.com', phone: '081234567803', gender: 'P' },
                    { id: 15, name: 'Irfan Maulana', nis: '2024015', email: 'irfan15@email.com', phone: '081234567804', gender: 'L' },
                    { id: 16, name: 'Jihan Aulia', nis: '2024016', email: 'jihan16@email.com', phone: '081234567805', gender: 'P' },
                    { id: 17, name: 'Krisna Adi', nis: '2024017', email: 'krisna17@email.com', phone: '081234567806', gender: 'L' },
                    { id: 18, name: 'Lintang Sari', nis: '2024018', email: 'lintang18@email.com', phone: '081234567807', gender: 'P' },
                    { id: 19, name: 'Maulana Yusuf', nis: '2024019', email: 'maulana19@email.com', phone: '081234567808', gender: 'L' },
                    { id: 20, name: 'Nadia Putri', nis: '2024020', email: 'nadia20@email.com', phone: '081234567809', gender: 'P' },
                    { id: 21, name: 'Oka Pratama', nis: '2024021', email: 'oka21@email.com', phone: '081234567810', gender: 'L' },
                    { id: 22, name: 'Putri Lestari', nis: '2024022', email: 'putri22@email.com', phone: '081234567811', gender: 'P' },
                    { id: 23, name: 'Rama Kusuma', nis: '2024023', email: 'rama23@email.com', phone: '081234567812', gender: 'L' },
                    { id: 24, name: 'Siska Anggraini', nis: '2024024', email: 'siska24@email.com', phone: '081234567813', gender: 'P' },
                    { id: 25, name: 'Taufik Hidayat', nis: '2024025', email: 'taufik25@email.com', phone: '081234567814', gender: 'L' },
                    { id: 26, name: 'Umi Kalsum', nis: '2024026', email: 'umi26@email.com', phone: '081234567815', gender: 'P' },
                    { id: 27, name: 'Vicky Prasetya', nis: '2024027', email: 'vicky27@email.com', phone: '081234567816', gender: 'L' },
                    { id: 28, name: 'Wulan Sari', nis: '2024028', email: 'wulan28@email.com', phone: '081234567817', gender: 'P' },
                    { id: 29, name: 'Xavier Adi', nis: '2024029', email: 'xavier29@email.com', phone: '081234567818', gender: 'L' },
                    { id: 30, name: 'Yuni Astuti', nis: '2024030', email: 'yuni30@email.com', phone: '081234567819', gender: 'P' },
                    { id: 31, name: 'Zaki Prasetyo', nis: '2024031', email: 'zaki31@email.com', phone: '081234567820', gender: 'L' },
                    { id: 32, name: 'Anisa Khoirunnisa', nis: '2024032', email: 'anisa32@email.com', phone: '081234567821', gender: 'P' },
                    { id: 33, name: 'Bayu Setiawan', nis: '2024033', email: 'bayu33@email.com', phone: '081234567822', gender: 'L' },
                    { id: 34, name: 'Citra Dewi', nis: '2024034', email: 'citra34@email.com', phone: '081234567823', gender: 'P' },
                    { id: 35, name: 'Dian Prasetya', nis: '2024035', email: 'dian35@email.com', phone: '081234567824', gender: 'L' },
                    { id: 36, name: 'Eva Lestari', nis: '2024036', email: 'eva36@email.com', phone: '081234567825', gender: 'P' }
                ];
            }

            loadTeachers() {
                return [
                    { 
                        id: 1, 
                        name: 'Bu Sari, S.Pd', 
                        subject: 'Matematika', 
                        qualification: 'S1 Pendidikan Matematika',
                        email: 'sari@sekolah.sch.id',
                        phone: '081234567800'
                    },
                    { 
                        id: 2, 
                        name: 'Pak Budi, M.Pd', 
                        subject: 'Fisika', 
                        qualification: 'S2 Pendidikan Fisika',
                        email: 'budi@sekolah.sch.id',
                        phone: '081234567801'
                    },
                    { 
                        id: 3, 
                        name: 'Bu Dewi, S.Pd', 
                        subject: 'Kimia', 
                        qualification: 'S1 Pendidikan Kimia',
                        email: 'dewi@sekolah.sch.id',
                        phone: '081234567802'
                    },
                    { 
                        id: 4, 
                        name: 'Pak Andi, S.Pd', 
                        subject: 'Biologi', 
                        qualification: 'S1 Pendidikan Biologi',
                        email: 'andi@sekolah.sch.id',
                        phone: '081234567803'
                    },
                    { 
                        id: 5, 
                        name: 'Bu Rini, M.Pd', 
                        subject: 'Bahasa Indonesia', 
                        qualification: 'S2 Pendidikan Bahasa Indonesia',
                        email: 'rini@sekolah.sch.id',
                        phone: '081234567804'
                    },
                    { 
                        id: 6, 
                        name: 'Bu Maya, S.Pd', 
                        subject: 'Bahasa Inggris', 
                        qualification: 'S1 Pendidikan Bahasa Inggris',
                        email: 'maya@sekolah.sch.id',
                        phone: '081234567805'
                    },
                    { 
                        id: 7, 
                        name: 'Pak Joko, S.Kom', 
                        subject: 'TIK Lanjut', 
                        qualification: 'S1 Teknik Informatika',
                        email: 'joko@sekolah.sch.id',
                        phone: '081234567806'
                    },
                    { 
                        id: 8, 
                        name: 'Bu Sinta, S.Sos', 
                        subject: 'Sosiologi Lanjut', 
                        qualification: 'S1 Sosiologi',
                        email: 'sinta@sekolah.sch.id',
                        phone: '081234567807'
                    },
                    { 
                        id: 9, 
                        name: 'Pak Rudi, S.E', 
                        subject: 'Ekonomi Lanjut', 
                        qualification: 'S1 Ekonomi',
                        email: 'rudi@sekolah.sch.id',
                        phone: '081234567808'
                    },
                    { 
                        id: 10, 
                        name: 'Bu Yuki, S.Pd', 
                        subject: 'Bahasa Jepang Lanjut', 
                        qualification: 'S1 Pendidikan Bahasa Jepang',
                        email: 'yuki@sekolah.sch.id',
                        phone: '081234567809'
                    }
                ];
            }

            loadSchedule() {
                const saved = localStorage.getItem('scheduleData');
                if (saved) {
                    return JSON.parse(saved);
                } else {
                    const defaultSchedule = {
                        'Senin': [
                            { time: '07:00-08:30', subject: 'Matematika', teacher: 'Bu Sari, S.Pd', room: 'Ruang 201', teacherStatus: 'present' },
                            { time: '08:30-10:00', subject: 'Fisika', teacher: 'Pak Budi, M.Pd', room: 'Lab Fisika', teacherStatus: 'present' },
                            { time: '10:00-11:30', subject: 'Kimia', teacher: 'Bu Dewi, S.Pd', room: 'Lab Kimia', teacherStatus: 'present' },
                            { time: '13:00-14:30', subject: 'TIK Lanjut', teacher: 'Pak Joko, S.Kom', room: 'Lab Komputer', teacherStatus: 'present' }
                        ],
                        'Selasa': [
                            { time: '07:00-08:30', subject: 'Biologi', teacher: 'Pak Andi, S.Pd', room: 'Lab Biologi', teacherStatus: 'present' },
                            { time: '08:30-10:00', subject: 'Bahasa Indonesia', teacher: 'Bu Rini, M.Pd', room: 'Ruang 201', teacherStatus: 'present' },
                            { time: '10:00-11:30', subject: 'Sosiologi Lanjut', teacher: 'Bu Sinta, S.Sos', room: 'Ruang 202', teacherStatus: 'present' }
                        ],
                        'Rabu': [
                            { time: '07:00-08:30', subject: 'Matematika', teacher: 'Bu Sari, S.Pd', room: 'Ruang 201', teacherStatus: 'present' },
                            { time: '08:30-10:00', subject: 'Fisika', teacher: 'Pak Budi, M.Pd', room: 'Lab Fisika', teacherStatus: 'present' },
                            { time: '10:00-11:30', subject: 'Bahasa Inggris', teacher: 'Bu Maya, S.Pd', room: 'Ruang 203', teacherStatus: 'present' }
                        ],
                        'Kamis': [
                            { time: '07:00-08:30', subject: 'Kimia', teacher: 'Bu Dewi, S.Pd', room: 'Lab Kimia', teacherStatus: 'present' },
                            { time: '08:30-10:00', subject: 'Biologi', teacher: 'Pak Andi, S.Pd', room: 'Lab Biologi', teacherStatus: 'present' },
                            { time: '10:00-11:30', subject: 'Ekonomi Lanjut', teacher: 'Pak Rudi, S.E', room: 'Ruang 204', teacherStatus: 'present' }
                        ],
                        'Jumat': [
                            { time: '07:00-08:30', subject: 'Bahasa Indonesia', teacher: 'Bu Rini, M.Pd', room: 'Ruang 201', teacherStatus: 'present' },
                            { time: '08:30-10:00', subject: 'Bahasa Jepang Lanjut', teacher: 'Bu Yuki, S.Pd', room: 'Ruang 205', teacherStatus: 'present' }
                        ],
                        'Sabtu': [
                            { time: '07:00-09:00', subject: 'Ekstrakurikuler', teacher: 'Various', room: 'Lapangan', teacherStatus: 'present' }
                        ]
                    };
                    localStorage.setItem('scheduleData', JSON.stringify(defaultSchedule));
                    return defaultSchedule;
                }
            }

            loadAttendance() {
                const saved = localStorage.getItem('attendanceData');
                if (saved) {
                    return JSON.parse(saved);
                } else {
                    // Create sample data for demonstration
                    const sampleData = {
                        records: [
                            // Sample records for demonstration
                            {
                                id: 1,
                                date: new Date().toISOString().split('T')[0],
                                subject: 'matematika',
                                studentId: 1,
                                studentName: 'Ahmad Rizki',
                                nis: '2024001',
                                status: 'present',
                                time: '07:15',
                                timestamp: new Date().toISOString()
                            },
                            {
                                id: 2,
                                date: new Date().toISOString().split('T')[0],
                                subject: 'matematika',
                                studentId: 2,
                                studentName: 'Sari Dewi',
                                nis: '2024002',
                                status: 'absent',
                                time: '07:15',
                                timestamp: new Date().toISOString()
                            },
                            {
                                id: 3,
                                date: new Date().toISOString().split('T')[0],
                                subject: 'fisika',
                                studentId: 3,
                                studentName: 'Budi Santoso',
                                nis: '2024003',
                                status: 'sick',
                                time: '08:45',
                                timestamp: new Date().toISOString()
                            },
                            {
                                id: 4,
                                date: new Date().toISOString().split('T')[0],
                                subject: 'kimia',
                                studentId: 4,
                                studentName: 'Maya Sari',
                                nis: '2024004',
                                status: 'permission',
                                time: '10:15',
                                timestamp: new Date().toISOString()
                            },
                            // Add more sample records for different dates
                            {
                                id: 5,
                                date: new Date(Date.now() - 86400000).toISOString().split('T')[0], // Yesterday
                                subject: 'matematika',
                                studentId: 2,
                                studentName: 'Sari Dewi',
                                nis: '2024002',
                                status: 'absent',
                                time: '07:15',
                                timestamp: new Date(Date.now() - 86400000).toISOString()
                            },
                            {
                                id: 6,
                                date: new Date(Date.now() - 86400000).toISOString().split('T')[0], // Yesterday
                                subject: 'fisika',
                                studentId: 3,
                                studentName: 'Budi Santoso',
                                nis: '2024003',
                                status: 'absent',
                                time: '08:45',
                                timestamp: new Date(Date.now() - 86400000).toISOString()
                            }
                        ]
                    };
                    localStorage.setItem('attendanceData', JSON.stringify(sampleData));
                    return sampleData;
                }
            }

            loadAssignments() {
                const saved = localStorage.getItem('assignmentData');
                return saved ? JSON.parse(saved) : { assignments: [] };
            }

            loadAnnouncement() {
                const saved = localStorage.getItem('announcementData');
                return saved ? JSON.parse(saved) : { text: "Persiapan Ujian Tengah Semester akan dimulai minggu depan. Mari persiapkan dengan baik!" };
            }

            loadGroups() {
                const saved = localStorage.getItem('groupData');
                return saved ? JSON.parse(saved) : { groups: [] };
            }

            loadActivities() {
                const saved = localStorage.getItem('activityData');
                if (saved) {
                    return JSON.parse(saved);
                } else {
                    // Create sample activities
                    const sampleActivities = [
                        {
                            id: 1,
                            type: 'attendance',
                            title: 'Absensi pagi telah diinput',
                            description: '28 siswa hadir',
                            time: new Date().toISOString(),
                            icon: 'clipboard-check'
                        },
                        {
                            id: 2,
                            type: 'assignment',
                            title: 'Tugas Matematika dikumpulkan',
                            description: '25 siswa mengumpulkan',
                            time: new Date(Date.now() - 86400000).toISOString(),
                            icon: 'tasks'
                        },
                        {
                            id: 3,
                            type: 'announcement',
                            title: 'Pengumuman baru dari Wali Kelas',
                            description: 'Persiapan UTS',
                            time: new Date(Date.now() - 172800000).toISOString(),
                            icon: 'comment'
                        },
                        {
                            id: 4,
                            type: 'assignment',
                            title: 'Tugas Fisika ditambahkan',
                            description: 'Deadline 3 hari lagi',
                            time: new Date(Date.now() - 259200000).toISOString(),
                            icon: 'tasks'
                        }
                    ];
                    localStorage.setItem('activityData', JSON.stringify(sampleActivities));
                    return sampleActivities;
                }
            }

            saveSchedule() {
                localStorage.setItem('scheduleData', JSON.stringify(this.schedule));
            }

            saveAttendance() {
                localStorage.setItem('attendanceData', JSON.stringify(this.attendance));
            }

            saveAssignments() {
                localStorage.setItem('assignmentData', JSON.stringify(this.assignments));
            }

            saveAnnouncementData() {
                localStorage.setItem('announcementData', JSON.stringify(this.announcement));
            }

            saveGroups() {
                localStorage.setItem('groupData', JSON.stringify(this.groups));
            }

            saveActivities() {
                localStorage.setItem('activityData', JSON.stringify(this.activities));
            }

            switchTab(tabName) {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                // Remove active class from all nav items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                // Show selected tab
                document.getElementById(tabName).classList.add('active');
                // Activate corresponding nav item
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                // Load specific tab data if needed
                if (tabName === 'absence-tracking') {
                    this.loadAbsenceTrackingTab();
                } else if (tabName === 'group-spinner') {
                    this.loadGroupSpinnerTab();
                } else if (tabName === 'schedule') {
                    this.loadScheduleTab();
                }
            }

            loadDashboard() {
                // Update stats based on today's attendance
                const today = new Date().toISOString().split('T')[0];
                const todayAttendance = this.attendance.records.filter(record => record.date === today);
                
                let presentCount = 0;
                let sickCount = 0;
                let permissionCount = 0;
                let absentCount = 0;
                
                // Reset counts
                this.students.forEach(student => {
                    const record = todayAttendance.find(r => r.studentId == student.id);
                    if (record) {
                        switch(record.status) {
                            case 'present': presentCount++; break;
                            case 'sick': sickCount++; break;
                            case 'permission': permissionCount++; break;
                            case 'absent': absentCount++; break;
                        }
                    } else {
                        absentCount++; // Jika tidak ada record, dianggap alpha
                    }
                });
                
                // Update the dashboard stats
                document.getElementById('presentCount').textContent = presentCount;
                document.getElementById('sickCount').textContent = sickCount;
                document.getElementById('permissionCount').textContent = permissionCount;
                document.getElementById('absentCount').textContent = absentCount;

                // Load today's schedule
                this.loadTodaySchedule();
                
                // Load upcoming assignments for dashboard
                this.loadUpcomingAssignments();
                
                // Load recent activities
                this.loadRecentActivities();
                
                // Load absence alerts for dashboard
                this.loadAbsenceAlerts();
            }

            loadTodaySchedule() {
                const todaySchedule = document.getElementById('todaySchedule');
                const today = new Date();
                const dayNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                const todayName = dayNames[today.getDay()];
                
                // Get today's schedule
                const todayLessons = this.schedule[todayName] || [];
                
                if (todayLessons.length > 0) {
                    todaySchedule.innerHTML = todayLessons.map((lesson, index) => {
                        // Determine if this lesson is current, upcoming, or past
                        const now = new Date();
                        const [startTime, endTime] = lesson.time.split('-');
                        const [startHour, startMinute] = startTime.split(':').map(Number);
                        const [endHour, endMinute] = endTime.split(':').map(Number);
                        
                        const lessonStart = new Date();
                        lessonStart.setHours(startHour, startMinute, 0, 0);
                        
                        const lessonEnd = new Date();
                        lessonEnd.setHours(endHour, endMinute, 0, 0);
                        
                        let status = 'akan-datang';
                        if (now >= lessonStart && now <= lessonEnd) {
                            status = 'current';
                        } else if (now > lessonEnd) {
                            status = 'selesai';
                        }
                        
                        // Determine teacher status
                        const teacherStatus = lesson.teacherStatus === 'absent' ? 'Tidak Hadir' : 'Hadir';
                        const teacherStatusClass = lesson.teacherStatus === 'absent' ? 'teacher-absent' : 'teacher-present';
                        
                        return `
                            <div class="enhanced-schedule-item ${status === 'current' ? 'current' : ''}">
                                <div class="schedule-time">${lesson.time}</div>
                                <div class="schedule-details">
                                    <h4>${lesson.subject}</h4>
                                    <p>${lesson.teacher}  ${lesson.room}</p>
                                </div>
                                <div class="schedule-status">
                                    ${teacherStatus}
                                </div>
                                <div class="teacher-status ${teacherStatusClass}">Guru ${teacherStatus}</div>
                                <button class="edit-schedule-btn" onclick="app.editTodaySchedule('${todayName}', ${index})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                        `;
                    }).join('');
                } else {
                    todaySchedule.innerHTML = `
                        <div class="empty-placeholder">
                            <i class="fas fa-calendar-times"></i>
                            <p>Tidak ada jadwal untuk hari ini.</p>
                        </div>
                    `;
                }
            }

            loadRecentActivities() {
                const recentActivityList = document.getElementById('recentActivityList');
                
                // Sort activities by time (newest first) and take the 3 most recent
                const recentActivities = [...this.activities]
                    .sort((a, b) => new Date(b.time) - new Date(a.time))
                    .slice(0, 3);
                
                if (recentActivities.length > 0) {
                    recentActivityList.innerHTML = recentActivities.map(activity => {
                        const timeAgo = this.getTimeAgo(new Date(activity.time));
                        
                        return `
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-${activity.icon}"></i>
                                </div>
                                <div class="activity-content">
                                    <p>${activity.title}</p>
                                    <span class="activity-time">${timeAgo}  ${activity.description}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    recentActivityList.innerHTML = `
                        <div class="empty-placeholder">
                            <i class="fas fa-history"></i>
                            <p>Tidak ada aktivitas terbaru.</p>
                        </div>
                    `;
                }
            }

            getTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'Baru saja';
                if (diffMins < 60) return `${diffMins} menit lalu`;
                if (diffHours < 24) return `${diffHours} jam lalu`;
                if (diffDays === 1) return 'Kemarin';
                if (diffDays < 7) return `${diffDays} hari lalu`;
                return date.toLocaleDateString('id-ID');
            }

            loadUpcomingAssignments() {
                const dashboardAssignmentsList = document.getElementById('dashboardAssignmentsList');
                const today = new Date();
                
                // Filter assignments that are active or urgent and not completed
                const upcomingAssignments = this.assignments.assignments
                    .filter(assignment => {
                        const deadline = new Date(assignment.deadline);
                        return (assignment.status === 'active' || assignment.status === 'urgent') && deadline >= today;
                    })
                    .sort((a, b) => new Date(a.deadline) - new Date(b.deadline))
                    .slice(0, 5); // Show 5 upcoming assignments

                if (upcomingAssignments.length > 0) {
                    dashboardAssignmentsList.innerHTML = upcomingAssignments.map(assignment => `
                        <div class="enhanced-assignment-item ${assignment.status}">
                            <div class="assignment-subject">${assignment.subject}</div>
                            <div class="assignment-title">${assignment.title}</div>
                            <div class="assignment-deadline">
                                <i class="fas fa-clock"></i>
                                Deadline: ${this.formatDateForDisplay(assignment.deadline)}
                            </div>
                        </div>
                    `).join('');
                } else {
                    dashboardAssignmentsList.innerHTML = `
                        <div class="empty-placeholder">
                            <i class="fas fa-tasks"></i>
                            <p>Tidak ada tugas mendatang.</p>
                        </div>
                    `;
                }
            }

            // NEW: Load absence alerts for dashboard
            loadAbsenceAlerts() {
                const absenceAlertList = document.getElementById('absenceAlertList');
                
                // Get students with multiple absences in the last 7 days
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                const recentAbsences = this.attendance.records.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate >= oneWeekAgo && 
                          (record.status === 'absent' || record.status === 'sick' || record.status === 'permission');
                });
                
                // Group by student and count absences
                const studentAbsenceCount = {};
                const studentAbsenceSubjects = {};
                
                recentAbsences.forEach(record => {
                    if (!studentAbsenceCount[record.studentId]) {
                        studentAbsenceCount[record.studentId] = 0;
                        studentAbsenceSubjects[record.studentId] = [];
                    }
                    studentAbsenceCount[record.studentId]++;
                    
                    // Add subject if not already in the list
                    if (!studentAbsenceSubjects[record.studentId].includes(record.subject)) {
                        studentAbsenceSubjects[record.studentId].push({
                            subject: record.subject,
                            status: record.status
                        });
                    }
                });
                
                // Filter students with 2 or more absences
                const studentsWithMultipleAbsences = Object.keys(studentAbsenceCount)
                    .filter(studentId => studentAbsenceCount[studentId] >= 2)
                    .map(studentId => {
                        const student = this.students.find(s => s.id == studentId);
                        return {
                            student,
                            absenceCount: studentAbsenceCount[studentId],
                            subjects: studentAbsenceSubjects[studentId]
                        };
                    })
                    .sort((a, b) => b.absenceCount - a.absenceCount)
                    .slice(0, 5); // Show top 5
                
                if (studentsWithMultipleAbsences.length > 0) {
                    absenceAlertList.innerHTML = studentsWithMultipleAbsences.map(item => `
                        <div class="absence-alert-item">
                            <div class="absence-alert-header">
                                <div class="absence-alert-student">${item.student.name} (${item.student.nis})</div>
                                <div class="absence-alert-count">${item.absenceCount} ketidakhadiran</div>
                            </div>
                            <div class="absence-alert-subjects">
                                ${item.subjects.map(subject => `
                                    <div class="absence-alert-subject ${subject.status}">
                                        <i class="fas fa-book"></i>
                                        ${this.getSubjectDisplayName(subject.subject)} (${this.getStatusText(subject.status)})
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                } else {
                    absenceAlertList.innerHTML = `
                        <div class="empty-placeholder">
                            <i class="fas fa-check-circle"></i>
                            <p>Tidak ada peringatan ketidakhadiran.</p>
                        </div>
                    `;
                }
            }

            formatDateForDisplay(dateString) {
                const date = new Date(dateString);
                const today = new Date();
                const diffTime = date - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 0) {
                    return "Hari Ini";
                } else if (diffDays === 1) {
                    return "Besok";
                } else if (diffDays <= 7) {
                    return `${diffDays} Hari Lagi`;
                } else {
                    return date.toLocaleDateString('id-ID');
                }
            }

            showAttendanceDetails(status) {
                const statusMap = {
                    'present': 'Hadir',
                    'sick': 'Sakit',
                    'permission': 'Izin',
                    'absent': 'Alpha'
                };
                
                const today = new Date().toISOString().split('T')[0];
                const studentsWithStatus = this.attendance.records
                    .filter(record => record.date === today && record.status === status)
                    .map(record => record.studentName);
                
                if (studentsWithStatus.length > 0) {
                    alert(`Siswa dengan status ${statusMap[status]} hari ini:\n\n${studentsWithStatus.join('\n')}`);
                } else {
                    alert(`Tidak ada siswa dengan status ${statusMap[status]} hari ini.`);
                }
            }

            loadAttendanceTab() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('attendanceDate').value = today;
                this.loadAttendanceData(today);
            }

            loadAttendanceData(date) {
                const tableBody = document.getElementById('attendanceTableBody');
                const dayRecords = this.attendance.records.filter(record => record.date === date);

                // Hitung jumlah kehadiran untuk ringkasan
                let presentCount = 0;
                let sickCount = 0;
                let permissionCount = 0;
                let absentCount = 0;
                
                // Reset counts
                this.students.forEach(student => {
                    const record = dayRecords.find(r => r.studentId == student.id);
                    if (record) {
                        switch(record.status) {
                            case 'present': presentCount++; break;
                            case 'sick': sickCount++; break;
                            case 'permission': permissionCount++; break;
                            case 'absent': absentCount++; break;
                        }
                    } else {
                        absentCount++; // Jika tidak ada record, dianggap alpha
                    }
                });

                const totalStudents = this.students.length;

                // Update ringkasan
                document.getElementById('totalStudentsSummary').textContent = totalStudents;
                document.getElementById('presentCountSummary').textContent = presentCount;
                document.getElementById('absentCountSummary').textContent = sickCount + permissionCount + absentCount;

                // Bangun HTML berdasarkan daftar semua siswa
                const tableRows = this.students.map((student, index) => {
                    // Cari record absensi untuk siswa ini pada tanggal ini
                    const record = dayRecords.find(r => r.studentId == student.id);

                    if (record) {
                        // Jika ditemukan, tampilkan statusnya
                        return `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${record.studentName}</td>
                                <td>${record.nis}</td>
                                <td>
                                    <span class="status-badge status-${record.status}">
                                        ${this.getStatusText(record.status)}
                                    </span>
                                </td>
                                <td>${record.time || 'N/A'}</td>
                                <td>${record.notes || '-'}</td>
                            </tr>
                        `;
                    } else {
                        // Jika tidak ditemukan, tampilkan status "Belum diisi"
                        return `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${student.name}</td>
                                <td>${student.nis}</td>
                                <td><span class="status-badge status-not-filled">Belum diisi</span></td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                        `;
                    }
                }).join('');

                tableBody.innerHTML = tableRows;
            }

            // NEW: Load absence tracking tab
            loadAbsenceTrackingTab() {
                this.loadAbsencePatterns();
            }

            // NEW: Load absence patterns based on filters
            loadAbsencePatterns() {
                const startDate = document.getElementById('absenceStartDate').value;
                const endDate = document.getElementById('absenceEndDate').value;
                const absenceType = document.getElementById('absenceTypeFilter').value;
                const threshold = parseInt(document.getElementById('absenceThreshold').value);
                
                // Filter records based on date range and type
                const filteredRecords = this.attendance.records.filter(record => {
                    const recordDate = new Date(record.date);
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    
                    const dateInRange = recordDate >= start && recordDate <= end;
                    const typeMatches = absenceType === 'all' || record.status === absenceType;
                    
                    return dateInRange && typeMatches && 
                          (record.status === 'absent' || record.status === 'sick' || record.status === 'permission');
                });
                
                // Group by student
                const studentAbsences = {};
                
                filteredRecords.forEach(record => {
                    if (!studentAbsences[record.studentId]) {
                        studentAbsences[record.studentId] = {
                            student: this.students.find(s => s.id == record.studentId),
                            absences: [],
                            subjects: new Set(),
                            total: 0
                        };
                    }
                    
                    studentAbsences[record.studentId].absences.push(record);
                    studentAbsences[record.studentId].subjects.add(record.subject);
                    studentAbsences[record.studentId].total++;
                });
                
                // Convert to array and filter by threshold
                const studentsWithAbsences = Object.values(studentAbsences)
                    .filter(item => item.total >= threshold)
                    .sort((a, b) => b.total - a.total);
                
                // Update the absence report table
                this.updateAbsenceReportTable(studentsWithAbsences);
                
                // Update the detailed absence alert list
                this.updateDetailedAbsenceAlerts(studentsWithAbsences);
            }

            // NEW: Update absence report table
            updateAbsenceReportTable(studentsWithAbsences) {
                const tableBody = document.getElementById('absenceReportTableBody');
                
                if (studentsWithAbsences.length > 0) {
                    tableBody.innerHTML = studentsWithAbsences.map((item, index) => `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.student.name}</td>
                            <td>${item.student.nis}</td>
                            <td>
                                <span class="absence-alert-count">${item.total}</span>
                            </td>
                            <td>
                                <div class="absence-alert-subjects">
                                    ${Array.from(item.subjects).map(subject => `
                                        <div class="absence-alert-subject">
                                            <i class="fas fa-book"></i>
                                            ${this.getSubjectDisplayName(subject)}
                                        </div>
                                    `).join('')}
                                </div>
                            </td>
                            <td>
                                <div class="absence-report-actions">
                                    <button class="btn-small" onclick="app.viewStudentAbsenceDetails(${item.student.id})">
                                        <i class="fas fa-eye"></i> Detail
                                    </button>
                                    <button class="btn-small" onclick="app.contactStudent(${item.student.id})">
                                        <i class="fas fa-phone"></i> Hubungi
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="empty-placeholder">
                                    <i class="fas fa-check-circle"></i>
                                    <p>Tidak ada siswa dengan ketidakhadiran yang memenuhi kriteria.</p>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }

            // NEW: Update detailed absence alerts
            updateDetailedAbsenceAlerts(studentsWithAbsences) {
                const detailedAlertList = document.getElementById('detailedAbsenceAlertList');
                
                if (studentsWithAbsences.length > 0) {
                    detailedAlertList.innerHTML = studentsWithAbsences.map(item => {
                        // Group absences by subject and status
                        const subjectStatusCount = {};
                        
                        item.absences.forEach(absence => {
                            const key = `${absence.subject}-${absence.status}`;
                            if (!subjectStatusCount[key]) {
                                subjectStatusCount[key] = {
                                    subject: absence.subject,
                                    status: absence.status,
                                    count: 0,
                                    dates: []
                                };
                            }
                            subjectStatusCount[key].count++;
                            subjectStatusCount[key].dates.push(absence.date);
                        });
                        
                        const subjectDetails = Object.values(subjectStatusCount);
                        
                        return `
                            <div class="absence-alert-item">
                                <div class="absence-alert-header">
                                    <div class="absence-alert-student">${item.student.name} (${item.student.nis})</div>
                                    <div class="absence-alert-count">${item.total} total ketidakhadiran</div>
                                </div>
                                <div class="absence-alert-subjects">
                                    ${subjectDetails.map(detail => `
                                        <div class="absence-alert-subject ${detail.status}">
                                            <i class="fas fa-book"></i>
                                            ${this.getSubjectDisplayName(detail.subject)} 
                                            (${this.getStatusText(detail.status)}): ${detail.count}x
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="absence-report-actions" style="margin-top: 10px;">
                                    <button class="btn-small" onclick="app.viewStudentAbsenceDetails(${item.student.id})">
                                        <i class="fas fa-eye"></i> Lihat Detail Lengkap
                                    </button>
                                    <button class="btn-small" onclick="app.contactParent(${item.student.id})">
                                        <i class="fas fa-user-friends"></i> Hubungi Orang Tua
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    detailedAlertList.innerHTML = `
                        <div class="empty-placeholder">
                            <i class="fas fa-check-circle"></i>
                            <p>Tidak ada siswa dengan ketidakhadiran tinggi.</p>
                        </div>
                    `;
                }
            }

            // NEW: View student absence details
            viewStudentAbsenceDetails(studentId) {
                const student = this.students.find(s => s.id === studentId);
                const studentAbsences = this.attendance.records.filter(record => 
                    record.studentId == studentId && 
                    (record.status === 'absent' || record.status === 'sick' || record.status === 'permission')
                );
                
                // Group by subject
                const absencesBySubject = {};
                studentAbsences.forEach(absence => {
                    if (!absencesBySubject[absence.subject]) {
                        absencesBySubject[absence.subject] = [];
                    }
                    absencesBySubject[absence.subject].push(absence);
                });
                
                const modal = document.getElementById('studentAbsenceModal');
                const title = document.getElementById('studentAbsenceModalTitle');
                const content = document.getElementById('studentAbsenceDetails');
                
                title.textContent = `Detail Ketidakhadiran - ${student.name}`;
                
                content.innerHTML = `
                    <div class="form-group">
                        <label>Nama Siswa:</label>
                        <p><strong>${student.name}</strong></p>
                    </div>
                    <div class="form-group">
                        <label>NIS:</label>
                        <p>${student.nis}</p>
                    </div>
                    <div class="form-group">
                        <label>Kontak:</label>
                        <p>${student.phone} | ${student.email}</p>
                    </div>
                    <div class="form-group">
                        <label>Total Ketidakhadiran:</label>
                        <p><strong>${studentAbsences.length} kali</strong></p>
                    </div>
                    <div class="form-group">
                        <label>Detail per Mata Pelajaran:</label>
                        ${Object.keys(absencesBySubject).map(subject => {
                            const subjectAbsences = absencesBySubject[subject];
                            const statusCount = {
                                absent: 0,
                                sick: 0,
                                permission: 0
                            };
                            
                            subjectAbsences.forEach(absence => {
                                statusCount[absence.status]++;
                            });
                            
                            return `
                                <div style="margin-bottom: 15px; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                                    <h4 style="margin-bottom: 8px;">${this.getSubjectDisplayName(subject)}</h4>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        ${statusCount.absent > 0 ? `
                                            <span class="status-badge status-absent">Alpha: ${statusCount.absent}</span>
                                        ` : ''}
                                        ${statusCount.sick > 0 ? `
                                            <span class="status-badge status-sick">Sakit: ${statusCount.sick}</span>
                                        ` : ''}
                                        ${statusCount.permission > 0 ? `
                                            <span class="status-badge status-permission">Izin: ${statusCount.permission}</span>
                                        ` : ''}
                                    </div>
                                    <div style="margin-top: 8px; font-size: 0.8rem;">
                                        <strong>Tanggal:</strong> ${subjectAbsences.map(a => new Date(a.date).toLocaleDateString('id-ID')).join(', ')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="form-group">
                        <button class="btn-primary" onclick="app.contactParent(${studentId})">
                            <i class="fas fa-user-friends"></i> Hubungi Orang Tua
                        </button>
                        <button class="btn-secondary" onclick="app.closeModal('studentAbsenceModal')">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                    </div>
                `;
                
                modal.style.display = 'block';
            }

            // NEW: Contact student/parent
            contactStudent(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (student && confirm(`Hubungi ${student.name} di ${student.phone}?`)) {
                    window.open(`tel:${student.phone}`);
                }
            }

            contactParent(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (student) {
                    const message = `Halo, saya dari SMA Negeri 1. Kami ingin memberitahukan bahwa ${student.name} memiliki beberapa ketidakhadiran di sekolah. Apakah Bapak/Ibu dapat memberikan konfirmasi?`;
                    
                    if (confirm(`Hubungi orang tua ${student.name} di ${student.phone}?\n\nPesan: ${message}`)) {
                        window.open(`https://wa.me/${student.phone.replace(/^0/, '62')}?text=${encodeURIComponent(message)}`);
                    }
                }
            }

            // NEW: Export absence report
            exportAbsenceReport() {
                const startDate = document.getElementById('absenceStartDate').value;
                const endDate = document.getElementById('absenceEndDate').value;
                const absenceType = document.getElementById('absenceTypeFilter').value;
                const threshold = parseInt(document.getElementById('absenceThreshold').value);
                
                // Filter records based on date range and type (same as loadAbsencePatterns)
                const filteredRecords = this.attendance.records.filter(record => {
                    const recordDate = new Date(record.date);
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    
                    const dateInRange = recordDate >= start && recordDate <= end;
                    const typeMatches = absenceType === 'all' || record.status === absenceType;
                    
                    return dateInRange && typeMatches && 
                          (record.status === 'absent' || record.status === 'sick' || record.status === 'permission');
                });
                
                // Group by student
                const studentAbsences = {};
                
                filteredRecords.forEach(record => {
                    if (!studentAbsences[record.studentId]) {
                        studentAbsences[record.studentId] = {
                            student: this.students.find(s => s.id == record.studentId),
                            absences: [],
                            subjects: new Set(),
                            total: 0
                        };
                    }
                    
                    studentAbsences[record.studentId].absences.push(record);
                    studentAbsences[record.studentId].subjects.add(record.subject);
                    studentAbsences[record.studentId].total++;
                });
                
                // Convert to array and filter by threshold
                const studentsWithAbsences = Object.values(studentAbsences)
                    .filter(item => item.total >= threshold)
                    .sort((a, b) => b.total - a.total);
                
                // Create CSV content
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "LAPORAN KETIDAKHADIRAN SISWA\n";
                csvContent += `Periode: ${new Date(startDate).toLocaleDateString('id-ID')} - ${new Date(endDate).toLocaleDateString('id-ID')}\n`;
                csvContent += `Jenis: ${absenceType === 'all' ? 'Semua' : this.getStatusText(absenceType)}\n`;
                csvContent += `Ambang Batas: ${threshold}+ ketidakhadiran\n\n`;
                
                csvContent += "No,Nama Siswa,NIS,Total Ketidakhadiran,Mata Pelajaran\n";
                
                studentsWithAbsences.forEach((item, index) => {
                    const subjects = Array.from(item.subjects).map(subject => 
                        this.getSubjectDisplayName(subject)
                    ).join('; ');
                    
                    csvContent += `${index + 1},${item.student.name},${item.student.nis},${item.total},"${subjects}"\n`;
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `laporan_ketidakhadiran_${startDate}_${endDate}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showToast('Laporan ketidakhadiran berhasil diekspor!');
            }

            // NEW: Get subject display name
            getSubjectDisplayName(subjectKey) {
                const subjectMap = {
                    'matematika': 'Matematika',
                    'fisika': 'Fisika',
                    'kimia': 'Kimia',
                    'biologi': 'Biologi',
                    'bindo': 'Bahasa Indonesia',
                    'bing': 'Bahasa Inggris',
                    'tik': 'TIK Lanjut',
                    'sosiologi': 'Sosiologi Lanjut',
                    'ekonomi': 'Ekonomi Lanjut',
                    'bahasa_jepang': 'Bahasa Jepang Lanjut'
                };
                return subjectMap[subjectKey] || subjectKey;
            }

            // NEW: Load group spinner tab
            loadGroupSpinnerTab() {
                // Display saved groups if available
                if (this.groups.groups && this.groups.groups.length > 0) {
                    this.displayGroups(this.groups.groups);
                }
            }

            // NEW: Generate random groups
            generateGroups() {
                const groupCount = parseInt(document.getElementById('groupCount').value);
                const method = document.getElementById('groupMethod').value;
                const includeAbsent = document.getElementById('includeAbsent').value;
                
                // Show spinner
                const spinner = document.getElementById('groupSpinner');
                spinner.style.display = 'flex';
                
                // Get students to include in groups
                let studentsToInclude = [...this.students];
                
                // Exclude absent students if selected
                if (includeAbsent === 'exclude') {
                    const today = new Date().toISOString().split('T')[0];
                    const todayAttendance = this.attendance.records.filter(record => record.date === today);
                    
                    studentsToInclude = studentsToInclude.filter(student => {
                        const record = todayAttendance.find(r => r.studentId == student.id);
                        return record && record.status === 'present';
                    });
                }
                
                // Simulate processing time
                setTimeout(() => {
                    let groups;
                    
                    switch(method) {
                        case 'balanced':
                            groups = this.createBalancedGroups(studentsToInclude, groupCount);
                            break;
                        case 'leader':
                            groups = this.createGroupsWithLeaders(studentsToInclude, groupCount);
                            break;
                        default:
                            groups = this.createRandomGroups(studentsToInclude, groupCount);
                    }
                    
                    // Hide spinner
                    spinner.style.display = 'none';
                    
                    // Display groups
                    this.displayGroups(groups);
                    
                    // Save groups
                    this.groups.groups = groups;
                    this.saveGroups();
                    
                    this.showToast('Kelompok berhasil dibuat!');
                }, 1500);
            }

            // NEW: Create random groups
            createRandomGroups(students, groupCount) {
                // Shuffle students array
                const shuffled = [...students].sort(() => 0.5 - Math.random());
                
                // Calculate group sizes
                const baseSize = Math.floor(shuffled.length / groupCount);
                const remainder = shuffled.length % groupCount;
                
                const groups = [];
                let startIndex = 0;
                
                for (let i = 0; i < groupCount; i++) {
                    const groupSize = baseSize + (i < remainder ? 1 : 0);
                    const groupMembers = shuffled.slice(startIndex, startIndex + groupSize);
                    startIndex += groupSize;
                    
                    groups.push({
                        name: `Kelompok ${i + 1}`,
                        members: groupMembers
                    });
                }
                
                return groups;
            }

            // NEW: Create balanced groups (by gender)
            createBalancedGroups(students, groupCount) {
                // Separate by gender
                const maleStudents = students.filter(s => s.gender === 'L');
                const femaleStudents = students.filter(s => s.gender === 'P');
                
                // Shuffle each group
                const shuffledMale = [...maleStudents].sort(() => 0.5 - Math.random());
                const shuffledFemale = [...femaleStudents].sort(() => 0.5 - Math.random());
                
                const groups = Array.from({ length: groupCount }, (_, i) => ({
                    name: `Kelompok ${i + 1}`,
                    members: []
                }));
                
                // Distribute male students
                shuffledMale.forEach((student, index) => {
                    groups[index % groupCount].members.push(student);
                });
                
                // Distribute female students
                shuffledFemale.forEach((student, index) => {
                    groups[index % groupCount].members.push(student);
                });
                
                return groups;
            }

            // NEW: Create groups with leaders
            createGroupsWithLeaders(students, groupCount) {
                // Get potential leaders (students with good attendance)
                const today = new Date().toISOString().split('T')[0];
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                const studentAttendanceCount = {};
                this.attendance.records.forEach(record => {
                    const recordDate = new Date(record.date);
                    if (recordDate >= oneWeekAgo && record.status === 'present') {
                        if (!studentAttendanceCount[record.studentId]) {
                            studentAttendanceCount[record.studentId] = 0;
                        }
                        studentAttendanceCount[record.studentId]++;
                    }
                });
                
                // Sort students by attendance (potential leaders first)
                const sortedStudents = [...students].sort((a, b) => {
                    const aCount = studentAttendanceCount[a.id] || 0;
                    const bCount = studentAttendanceCount[b.id] || 0;
                    return bCount - aCount;
                });
                
                const groups = Array.from({ length: groupCount }, (_, i) => ({
                    name: `Kelompok ${i + 1}`,
                    members: []
                }));
                
                // Assign leaders
                sortedStudents.slice(0, groupCount).forEach((student, index) => {
                    groups[index].members.push({
                        ...student,
                        isLeader: true
                    });
                });
                
                // Distribute remaining students
                const remainingStudents = sortedStudents.slice(groupCount);
                const shuffledRemaining = [...remainingStudents].sort(() => 0.5 - Math.random());
                
                shuffledRemaining.forEach((student, index) => {
                    groups[index % groupCount].members.push(student);
                });
                
                return groups;
            }

            // NEW: Display groups
            displayGroups(groups) {
                const container = document.getElementById('groupsContainer');
                
                if (groups.length > 0) {
                    container.innerHTML = groups.map(group => `
                        <div class="group-card">
                            <div class="group-header">
                                <div class="group-name">${group.name}</div>
                                <div class="group-member-count">${group.members.length} anggota</div>
                            </div>
                            <div class="group-members">
                                ${group.members.map((member, index) => `
                                    <div class="group-member">
                                        <div class="group-member-avatar">
                                            ${member.name.split(' ').map(n => n[0]).join('')}
                                        </div>
                                        <div>
                                            <div>${member.name}</div>
                                            <div style="font-size: 0.7rem; color: var(--text-light);">${member.nis}</div>
                                        </div>
                                        ${member.isLeader ? `
                                            <div style="margin-left: auto;">
                                                <span class="status-badge status-present" style="font-size: 0.6rem;">Ketua</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="empty-placeholder">
                            <i class="fas fa-users"></i>
                            <p>Belum ada kelompok yang dibuat.</p>
                        </div>
                    `;
                }
            }

            // NEW: Regenerate groups
            regenerateGroups() {
                this.generateGroups();
            }

            // NEW: Export groups
            exportGroups() {
                if (!this.groups.groups || this.groups.groups.length === 0) {
                    this.showToast('Tidak ada kelompok untuk diekspor!', 'error');
                    return;
                }
                
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "PEMBAGIAN KELOMPOK SISWA\n";
                csvContent += `Tanggal: ${new Date().toLocaleDateString('id-ID')}\n\n`;
                
                this.groups.groups.forEach(group => {
                    csvContent += `${group.name}\n`;
                    csvContent += "No,Nama Siswa,NIS,Peran\n";
                    
                    group.members.forEach((member, index) => {
                        const role = member.isLeader ? 'Ketua Kelompok' : 'Anggota';
                        csvContent += `${index + 1},${member.name},${member.nis},${role}\n`;
                    });
                    
                    csvContent += "\n";
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `pembagian_kelompok_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showToast('Kelompok berhasil diekspor!');
            }

            loadScheduleTab() {
                const scheduleGrid = document.getElementById('scheduleGrid');
                const times = ['07:00-08:30', '08:30-10:00', '10:00-11:30', '11:30-13:00', '13:00-14:30'];
                const days = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                let scheduleHTML = '';
                
                times.forEach(time => {
                    scheduleHTML += `<div class="schedule-cell time">${time}</div>`;
                    days.forEach(day => {
                        const lessons = this.schedule[day]?.filter(lesson => lesson.time === time) || [];
                        scheduleHTML += `
                            <div class="schedule-cell">
                                ${lessons.map((lesson, index) => `
                                    <div class="schedule-lesson" onclick="app.showLessonDetails('${lesson.subject}', '${lesson.teacher}', '${lesson.room}')">
                                        <h5>${lesson.subject}</h5>
                                        <p>${lesson.teacher}</p>
                                        <small>${lesson.room}</small>
                                        ${lesson.teacherStatus === 'absent' ? 
                                            `<div class="teacher-status teacher-absent">Guru Tidak Hadir</div>` : 
                                            `<div class="teacher-status teacher-present">Guru Hadir</div>`
                                        }
                                        <div class="schedule-lesson-actions">
                                            <button class="schedule-edit-btn" onclick="app.editSchedule('${day}', ${index}, event)">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    });
                });
                scheduleGrid.innerHTML = scheduleHTML;
            }

            showLessonDetails(subject, teacher, room) {
                alert(`Detail Pelajaran:\n\nMata Pelajaran: ${subject}\nGuru: ${teacher}\nRuangan: ${room}`);
            }

            // NEW: Show schedule modal
            showScheduleModal() {
                const modal = document.getElementById('scheduleModal');
                const title = document.getElementById('scheduleModalTitle');
                const form = document.getElementById('scheduleForm');
                
                title.textContent = 'Tambah Jadwal Baru';
                form.reset();
                
                modal.style.display = 'block';
            }

            // NEW: Edit schedule
            editSchedule(day, index, event) {
                event.stopPropagation();
                
                const modal = document.getElementById('scheduleModal');
                const title = document.getElementById('scheduleModalTitle');
                const form = document.getElementById('scheduleForm');
                
                title.textContent = 'Edit Jadwal Pelajaran';
                
                const lesson = this.schedule[day][index];
                
                document.getElementById('scheduleId').value = `${day}-${index}`;
                document.getElementById('scheduleDay').value = day;
                document.getElementById('scheduleTime').value = lesson.time;
                document.getElementById('scheduleSubject').value = lesson.subject;
                document.getElementById('scheduleTeacher').value = lesson.teacher;
                document.getElementById('scheduleRoom').value = lesson.room;
                document.getElementById('teacherStatus').value = lesson.teacherStatus || 'present';
                
                modal.style.display = 'block';
            }

            // NEW: Edit today's schedule
            editTodaySchedule(day, index) {
                const modal = document.getElementById('scheduleModal');
                const title = document.getElementById('scheduleModalTitle');
                const form = document.getElementById('scheduleForm');
                
                title.textContent = 'Edit Jadwal Hari Ini';
                
                const lesson = this.schedule[day][index];
                
                document.getElementById('scheduleId').value = `${day}-${index}`;
                document.getElementById('scheduleDay').value = day;
                document.getElementById('scheduleTime').value = lesson.time;
                document.getElementById('scheduleSubject').value = lesson.subject;
                document.getElementById('scheduleTeacher').value = lesson.teacher;
                document.getElementById('scheduleRoom').value = lesson.room;
                document.getElementById('teacherStatus').value = lesson.teacherStatus || 'present';
                
                modal.style.display = 'block';
            }

            // NEW: Submit schedule
            submitSchedule() {
                const id = document.getElementById('scheduleId').value;
                const day = document.getElementById('scheduleDay').value;
                const time = document.getElementById('scheduleTime').value;
                const subject = document.getElementById('scheduleSubject').value;
                const teacher = document.getElementById('scheduleTeacher').value;
                const room = document.getElementById('scheduleRoom').value;
                const teacherStatus = document.getElementById('teacherStatus').value;
                
                if (id) {
                    // Edit existing schedule
                    const [scheduleDay, scheduleIndex] = id.split('-');
                    if (this.schedule[scheduleDay] && this.schedule[scheduleDay][scheduleIndex]) {
                        // If day changed, remove from old day and add to new day
                        if (scheduleDay !== day) {
                            this.schedule[scheduleDay].splice(scheduleIndex, 1);
                            if (!this.schedule[day]) {
                                this.schedule[day] = [];
                            }
                            this.schedule[day].push({
                                time,
                                subject,
                                teacher,
                                room,
                                teacherStatus
                            });
                        } else {
                            // Update in same day
                            this.schedule[day][scheduleIndex] = {
                                time,
                                subject,
                                teacher,
                                room,
                                teacherStatus
                            };
                        }
                    }
                } else {
                    // Add new schedule
                    if (!this.schedule[day]) {
                        this.schedule[day] = [];
                    }
                    this.schedule[day].push({
                        time,
                        subject,
                        teacher,
                        room,
                        teacherStatus
                    });
                }
                
                // Sort schedule by time
                Object.keys(this.schedule).forEach(day => {
                    this.schedule[day].sort((a, b) => {
                        const aTime = a.time.split('-')[0];
                        const bTime = b.time.split('-')[0];
                        return aTime.localeCompare(bTime);
                    });
                });
                
                this.saveSchedule();
                this.closeModal('scheduleModal');
                this.loadScheduleTab();
                this.loadTodaySchedule();
                this.showToast('Jadwal berhasil disimpan!');
            }

            loadStudentsTab() {
                const studentsGrid = document.getElementById('studentsGrid');
                studentsGrid.innerHTML = this.students.map(student => `
                    <div class="student-card" onclick="app.showStudentDetails(${student.id})">
                        <div class="student-avatar-large">
                            ${student.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <h4>${student.name}</h4>
                        <div class="student-nis">NIS: ${student.nis}</div>
                        <div class="student-contact">
                            <div><i class="fas fa-envelope"></i> ${student.email}</div>
                            <div><i class="fas fa-phone"></i> ${student.phone}</div>
                        </div>
                    </div>
                `).join('');
            }

            showStudentDetails(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (student) {
                    alert(`Detail Siswa:\n\nNama: ${student.name}\nNIS: ${student.nis}\nEmail: ${student.email}\nTelepon: ${student.phone}`);
                }
            }

            loadTeachersTab() {
                const teachersGrid = document.getElementById('teachersGrid');
                teachersGrid.innerHTML = this.teachers.map(teacher => `
                    <div class="teacher-card" onclick="app.showTeacherDetails(${teacher.id})">
                        <div class="teacher-avatar">
                            ${teacher.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div class="teacher-info">
                            <h4>${teacher.name}</h4>
                            <div class="teacher-subject">${teacher.subject}</div>
                            <div class="teacher-qualification">${teacher.qualification}</div>
                            <div class="teacher-contact">
                                <small><i class="fas fa-envelope"></i> ${teacher.email}</small><br>
                                <small><i class="fas fa-phone"></i> ${teacher.phone}</small>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            showTeacherDetails(teacherId) {
                const teacher = this.teachers.find(t => t.id === teacherId);
                if (teacher) {
                    alert(`Detail Guru:\n\nNama: ${teacher.name}\nMata Pelajaran: ${teacher.subject}\nKualifikasi: ${teacher.qualification}\nEmail: ${teacher.email}\nTelepon: ${teacher.phone}`);
                }
            }

            loadAssignmentsTab() {
                const assignmentsList = document.getElementById('assignmentsList');
                const assignments = this.assignments.assignments.length > 0 ? 
                    this.assignments.assignments : 
                    [
                        {
                            id: 1,
                            subject: 'Matematika',
                            title: 'Tugas Trigonometri - Bab 5',
                            deadline: '2024-10-12',
                            status: 'urgent',
                            description: 'Kerjakan soal nomor 1-10 halaman 125',
                            type: 'pr'
                        },
                        {
                            id: 2,
                            subject: 'Fisika',
                            title: 'Laporan Praktikum Hukum Newton',
                            deadline: '2024-10-15',
                            status: 'active',
                            description: 'Buat laporan hasil praktikum kelompok',
                            type: 'proyek'
                        },
                        {
                            id: 3,
                            subject: 'Kimia',
                            title: 'Tabel Periodik Unsur',
                            deadline: '2024-10-08',
                            status: 'completed',
                            description: 'Hafalkan 20 unsur pertama tabel periodik',
                            type: 'ulangan'
                        },
                        {
                            id: 4,
                            subject: 'Bahasa Indonesia',
                            title: 'Analisis Puisi Chairil Anwar',
                            deadline: '2024-10-18',
                            status: 'active',
                            description: 'Analisis 3 puisi karya Chairil Anwar',
                            type: 'pr'
                        },
                        {
                            id: 5,
                            subject: 'Biologi',
                            title: 'Laporan Sistem Pencernaan',
                            deadline: '2024-10-20',
                            status: 'active',
                            description: 'Buat laporan tentang sistem pencernaan manusia',
                            type: 'proyek'
                        }
                    ];
                
                this.assignments.assignments = assignments;
                this.saveAssignments();
                
                assignmentsList.innerHTML = assignments.map(assignment => `
                    <div class="enhanced-assignment-item ${assignment.status}">
                        <div class="assignment-header">
                            <div class="assignment-subject">${assignment.subject}</div>
                            <div class="assignment-status ${assignment.status}">
                                ${this.getAssignmentStatusText(assignment.status)}
                            </div>
                        </div>
                        <div class="assignment-title">${assignment.title}</div>
                        <div class="assignment-description">${assignment.description}</div>
                        <div class="assignment-footer">
                            <div class="assignment-deadline">
                                <i class="fas fa-clock"></i>
                                Deadline: ${new Date(assignment.deadline).toLocaleDateString('id-ID')}
                            </div>
                            <div class="assignment-type">
                                <i class="fas fa-tag"></i>
                                ${this.getAssignmentTypeText(assignment.type)}
                            </div>
                        </div>
                        <div class="assignment-actions">
                            <button class="btn-small" onclick="app.editAssignment(${assignment.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-small" onclick="app.deleteAssignment(${assignment.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            showAssignmentModal(assignmentId = null) {
                const modal = document.getElementById('assignmentModal');
                const title = document.getElementById('assignmentModalTitle');
                const form = document.getElementById('assignmentForm');
                
                if (assignmentId) {
                    // Edit mode
                    title.textContent = 'Edit Tugas';
                    const assignment = this.assignments.assignments.find(a => a.id === assignmentId);
                    if (assignment) {
                        document.getElementById('assignmentId').value = assignment.id;
                        document.getElementById('assignmentSubject').value = assignment.subject;
                        document.getElementById('assignmentTitle').value = assignment.title;
                        document.getElementById('assignmentDescription').value = assignment.description;
                        document.getElementById('assignmentDeadline').value = assignment.deadline;
                        document.getElementById('assignmentType').value = assignment.type;
                        document.getElementById('assignmentStatus').value = assignment.status;
                    }
                } else {
                    // Add mode
                    title.textContent = 'Tambah Tugas Baru';
                    form.reset();
                    // Set default deadline to tomorrow
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    document.getElementById('assignmentDeadline').value = tomorrow.toISOString().split('T')[0];
                }
                
                modal.style.display = 'block';
            }

            editAssignment(assignmentId) {
                this.showAssignmentModal(assignmentId);
            }

            deleteAssignment(assignmentId) {
                if (confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {
                    this.assignments.assignments = this.assignments.assignments.filter(a => a.id !== assignmentId);
                    this.saveAssignments();
                    this.loadAssignmentsTab();
                    this.loadUpcomingAssignments(); // Update dashboard assignments
                    this.showToast('Tugas berhasil dihapus!');
                }
            }

            showAttendanceModal() {
                const modal = document.getElementById('attendanceModal');
                modal.style.display = 'block';
                // Set today's date
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('modalDate').value = today;
                // Load students for attendance - menampilkan semua siswa
                this.loadAttendanceStudents();
            }

            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }

            loadAttendanceStudents() {
                const modalDate = document.getElementById('modalDate').value;
                const modalSubject = document.getElementById('modalSubject').value;
                const container = document.getElementById('attendanceStudentsList');

                // Ambil data absensi sebelumnya untuk tanggal dan mata pelajaran ini
                const previousAttendance = this.attendance.records.filter(record => 
                    record.date === modalDate && record.subject === modalSubject
                );

                container.innerHTML = this.students.map(student => {
                    // Cek apakah ada data absensi sebelumnya untuk siswa ini
                    const previousRecord = previousAttendance.find(record => record.studentId == student.id);
                    const previousStatus = previousRecord ? previousRecord.status : null;

                    return `
                        <div class="attendance-student-item" data-student-id="${student.id}" ${previousStatus ? `data-selected-status="${previousStatus}"` : ''}>
                            <div class="student-attendance-info">
                                <div class="student-avatar-small">
                                    ${student.name.split(' ').map(n => n[0]).join('')}
                                </div>
                                <div>
                                    <div class="student-name">${student.name}</div>
                                    <div class="student-nis">NIS: ${student.nis}</div>
                                </div>
                            </div>
                            <div class="attendance-options-small">
                                <button type="button" class="attendance-btn-small present ${previousStatus === 'present' ? 'active' : ''}" data-status="present">H</button>
                                <button type="button" class="attendance-btn-small sick ${previousStatus === 'sick' ? 'active' : ''}" data-status="sick">S</button>
                                <button type="button" class="attendance-btn-small permission ${previousStatus === 'permission' ? 'active' : ''}" data-status="permission">I</button>
                                <button type="button" class="attendance-btn-small absent ${previousStatus === 'absent' ? 'active' : ''}" data-status="absent">A</button>
                            </div>
                        </div>
                    `;
                }).join('');

                // Tambahkan event listeners untuk tombol absensi
                container.querySelectorAll('.attendance-btn-small').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const studentItem = e.target.closest('.attendance-student-item');
                        const status = e.target.dataset.status;
                        // Hapus kelas aktif dari semua tombol dalam item siswa ini
                        studentItem.querySelectorAll('.attendance-btn-small').forEach(b => {
                            b.classList.remove('active');
                        });
                        // Tambahkan kelas aktif ke tombol yang diklik
                        e.target.classList.add('active');
                        // Simpan status yang dipilih ke atribut data
                        studentItem.dataset.selectedStatus = status;
                    });
                });
            }

            submitAttendance() {
                const date = document.getElementById('modalDate').value;
                const subject = document.getElementById('modalSubject').value;
                const studentItems = document.querySelectorAll('.attendance-student-item');

                if (studentItems.length === 0) {
                    this.showToast('Tidak ada siswa untuk diinputkan absensinya!', 'error');
                    return;
                }

                // Hapus data absensi sebelumnya untuk tanggal dan mata pelajaran yang sama
                this.attendance.records = this.attendance.records.filter(record => 
                    !(record.date === date && record.subject === subject)
                );

                // Loop semua siswa untuk menyimpan statusnya
                studentItems.forEach(item => {
                    const studentId = item.dataset.studentId;
                    const selectedStatus = item.dataset.selectedStatus || 'absent'; // Default ke absent jika tidak dipilih
                    const student = this.students.find(s => s.id == studentId);

                    // Tambahkan record baru
                    this.attendance.records.push({
                        id: Date.now() + studentId,
                        date: date,
                        subject: subject,
                        studentId: studentId,
                        studentName: student.name,
                        nis: student.nis,
                        status: selectedStatus,
                        time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                        timestamp: new Date().toISOString()
                    });
                });

                // Add activity
                this.addActivity('attendance', 'Absensi harian diinput', `${this.getSubjectDisplayName(subject)} - ${date}`);

                this.saveAttendance();
                this.closeModal('attendanceModal');
                this.loadAttendanceData(date);
                this.loadDashboard(); // Update dashboard stats
                this.showToast('Absensi berhasil disimpan!');
            }

            addActivity(type, title, description) {
                const newActivity = {
                    id: Date.now(),
                    type: type,
                    title: title,
                    description: description,
                    time: new Date().toISOString(),
                    icon: this.getActivityIcon(type)
                };
                
                this.activities.unshift(newActivity);
                this.saveActivities();
            }

            getActivityIcon(type) {
                const iconMap = {
                    'attendance': 'clipboard-check',
                    'assignment': 'tasks',
                    'announcement': 'comment',
                    'group': 'users'
                };
                return iconMap[type] || 'info-circle';
            }

            submitAssignment() {
                const id = document.getElementById('assignmentId').value;
                const subject = document.getElementById('assignmentSubject').value;
                const title = document.getElementById('assignmentTitle').value;
                const description = document.getElementById('assignmentDescription').value;
                const deadline = document.getElementById('assignmentDeadline').value;
                const type = document.getElementById('assignmentType').value;
                const status = document.getElementById('assignmentStatus').value;
                
                if (id) {
                    // Edit existing assignment
                    const assignmentIndex = this.assignments.assignments.findIndex(a => a.id == id);
                    if (assignmentIndex !== -1) {
                        this.assignments.assignments[assignmentIndex] = {
                            id: parseInt(id),
                            subject,
                            title,
                            description,
                            deadline,
                            type,
                            status,
                            updated: new Date().toISOString()
                        };
                    }
                } else {
                    // Add new assignment
                    const newAssignment = {
                        id: Date.now(),
                        subject: subject,
                        title: title,
                        description: description,
                        deadline: deadline,
                        type: type,
                        status: status,
                        created: new Date().toISOString()
                    };

                    if (!this.assignments.assignments) {
                        this.assignments.assignments = [];
                    }
                    
                    this.assignments.assignments.push(newAssignment);
                    
                    // Add activity
                    this.addActivity('assignment', 'Tugas baru ditambahkan', `${subject} - ${title}`);
                }
                
                this.saveAssignments();
                this.closeModal('assignmentModal');
                this.loadAssignmentsTab();
                this.loadUpcomingAssignments(); // Update dashboard assignments
                this.showToast('Tugas berhasil disimpan!');
            }

            filterStudents(query) {
                const filteredStudents = this.students.filter(student => 
                    student.name.toLowerCase().includes(query.toLowerCase()) ||
                    student.nis.includes(query)
                );
                const studentsGrid = document.getElementById('studentsGrid');
                studentsGrid.innerHTML = filteredStudents.map(student => `
                    <div class="student-card" onclick="app.showStudentDetails(${student.id})">
                        <div class="student-avatar-large">
                            ${student.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <h4>${student.name}</h4>
                        <div class="student-nis">NIS: ${student.nis}</div>
                        <div class="student-contact">
                            <div><i class="fas fa-envelope"></i> ${student.email}</div>
                            <div><i class="fas fa-phone"></i> ${student.phone}</div>
                        </div>
                    </div>
                `).join('');
            }

            filterAssignments(filter) {
                const assignmentsList = document.getElementById('assignmentsList');
                let filteredAssignments = this.assignments.assignments;
                
                if (filter !== 'all') {
                    filteredAssignments = filteredAssignments.filter(a => a.status === filter);
                }
                
                assignmentsList.innerHTML = filteredAssignments.map(assignment => `
                    <div class="enhanced-assignment-item ${assignment.status}">
                        <div class="assignment-header">
                            <div class="assignment-subject">${assignment.subject}</div>
                            <div class="assignment-status ${assignment.status}">
                                ${this.getAssignmentStatusText(assignment.status)}
                            </div>
                        </div>
                        <div class="assignment-title">${assignment.title}</div>
                        <div class="assignment-description">${assignment.description}</div>
                        <div class="assignment-footer">
                            <div class="assignment-deadline">
                                <i class="fas fa-clock"></i>
                                Deadline: ${new Date(assignment.deadline).toLocaleDateString('id-ID')}
                            </div>
                            <div class="assignment-type">
                                <i class="fas fa-tag"></i>
                                ${this.getAssignmentTypeText(assignment.type)}
                            </div>
                        </div>
                        <div class="assignment-actions">
                            <button class="btn-small" onclick="app.editAssignment(${assignment.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-small" onclick="app.deleteAssignment(${assignment.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            editAnnouncement() {
                const modal = document.getElementById('announcementModal');
                document.getElementById('announcementTextInput').value = this.announcement.text;
                modal.style.display = 'block';
            }

            saveAnnouncement() {
                const newText = document.getElementById('announcementTextInput').value;
                this.announcement.text = newText;
                this.saveAnnouncementData();
                this.updateAnnouncement();
                this.closeModal('announcementModal');
                this.showToast('Pengumuman berhasil diperbarui!');
            }

            updateAnnouncement() {
                const announcementEl = document.getElementById('announcementText');
                if (announcementEl) {
                    // Add animation
                    announcementEl.style.opacity = '0';
                    setTimeout(() => {
                        announcementEl.textContent = this.announcement.text;
                        announcementEl.style.opacity = '1';
                    }, 300);
                }
            }

            exportAttendance() {
                const date = document.getElementById('attendanceDate').value;
                const dayRecords = this.attendance.records.filter(record => record.date === date);
                
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "No,Nama Siswa,NIS,Status,Waktu,Keterangan\n";
                
                this.students.forEach((student, index) => {
                    const record = dayRecords.find(r => r.studentId == student.id);
                    const status = record ? this.getStatusText(record.status) : 'Belum diisi';
                    const time = record ? record.time : '-';
                    const notes = record ? (record.notes || '-') : '-';
                    
                    csvContent += `${index + 1},${student.name},${student.nis},${status},${time},${notes}\n`;
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `absensi_${date}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            getStatusText(status) {
                const statusMap = {
                    'present': 'Hadir',
                    'sick': 'Sakit',
                    'permission': 'Izin',
                    'absent': 'Alpha'
                };
                return statusMap[status] || status;
            }

            getAssignmentStatusText(status) {
                const statusMap = {
                    'urgent': 'Mendesak',
                    'active': 'Aktif',
                    'completed': 'Selesai'
                };
                return statusMap[status] || status;
            }

            getAssignmentTypeText(type) {
                const typeMap = {
                    'pr': 'Pekerjaan Rumah',
                    'ulangan': 'Ulangan',
                    'proyek': 'Proyek',
                    'lainnya': 'Lainnya'
                };
                return typeMap[type] || type;
            }

            // NEW: Toast notification
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                
                if (type === 'error') {
                    toast.classList.add('error');
                }
                
                document.body.appendChild(toast);
                
                // Show toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 100);
                
                // Hide toast after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 400);
                }, 3000);
            }
        }

        // Initialize the application
        const app = new ClassWebsite();

        // Loading screen animation
        window.addEventListener('load', function() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingProgress = document.getElementById('loadingProgress');
            const classWebsite = document.getElementById('classWebsite');
            
            // Simulate loading progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // Hide loading screen and show website
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        classWebsite.classList.add('loaded');
                    }, 500);
                }
                loadingProgress.style.width = `${progress}%`;
            }, 200);
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let modal of modals) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }
        }

        // Set default date to today
        window.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = today;
        });
    </script>
</body>
</html>
